<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width,initial-scale=1,maximum-scale=2 name=viewport><meta content=#222 name=theme-color><meta content=IE=edge,chrome=1 http-equiv=X-UA-COMPATIBLE><meta content=webkit name=renderer><link href=/assets/favicon.ico rel=icon sizes=32x32 type=image/ico><link href=/assets/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/rss.xml rel=alternate title=欢迎来到Lyanv的小破站 type=application/rss+xml><link href=/atom.xml rel=alternate title=欢迎来到Lyanv的小破站 type=application/atom+xml><link href=https://liuyanv.github.io/feed.json rel=alternate title=欢迎来到Lyanv的小破站 type=application/json><link href=https://lf9-cdn-tos.bytecdntp.com rel=preconnect><link href=https://cdn.jsdelivr.net rel=dns-prefetch><link href=https://unpkg.com rel=dns-prefetch><link href=https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext rel=stylesheet><link href=/css/app.css?v=0.3.13 rel=stylesheet><meta content=Python name=keywords><link href=https://liuyanv.github.io/2024/02/04/Python%E9%AB%98%E7%BA%A7/ rel=canonical><title>Python高级</title><meta content="Hexo 7.1.1" name=generator><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=cat><div class=body></div><div class=head><div class=face></div></div><div class=foot><div class=tummy-end></div><div class=bottom></div><div class="legs left"></div><div class="legs right"></div></div><div class=paw><div class="hands left"></div><div class="hands right"></div></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">Python高级</h1><div class=meta><span title="创建时间：2024-02-04 23:10:20" class=item><span class=icon><i class="ic i-calendar"></i></span><span class=text>发表于</span><time itemprop="dateCreated datePublished" datetime=2024-02-04T23:10:20+08:00>2024-02-04</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span><span class=text>本文字数</span><span>56k</span><span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span><span class=text>阅读时长</span><span>51 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div aria-label=切换导航栏 class=lines><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>LyanvのBlog</a></ul><ul class=right id=rightNav><li class="item theme" @click=changeThemeByBtn><i :class="{'i-sun': !themeStatus,'i-moon': themeStatus}" class=ic></i><li class="item search"><i class="ic i-search"></i></ul></div></nav></div><div class=pjax id=imgs><img src=https://i.imgtg.com/2023/03/09/Y0hOs.jpg></div></header><div id=waves><svg viewbox="0 24 150 28" class=waves preserveaspectratio=none shape-rendering=auto xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" id=gentle-wave></path></defs><g class=parallax><use x=48 xlink:href=#gentle-wave y=0></use><use x=48 xlink:href=#gentle-wave y=3></use><use x=48 xlink:href=#gentle-wave y=5></use><use x=48 xlink:href=#gentle-wave y=7></use></g></svg></div><main><div class=inner><div class=pjax id=main><div class="article wrap"><div class=breadcrumb itemlistelement itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i><span><a href=/>首页</a></span><i class="ic i-angle-right"></i><span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/Python/ itemprop=item rel=index title=分类于Python><span itemprop=name>Python<meta content=0 itemprop=position></span></a></span></div><article class="post block" itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://liuyanv.github.io/2024/02/04/Python%E9%AB%98%E7%BA%A7/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta content=/assets/avatar.jpg itemprop=image><meta content=Liuyanv itemprop=name><meta content="一个小小的Notebook, 神鬼二象性" itemprop=description></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta content=欢迎来到Lyanv的小破站 itemprop=name></span><div class="body md" itemprop=articleBody><h1 id=面向对象编程><a class=anchor href=#面向对象编程>#</a> 面向对象编程</h1><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></table></figure><p>采用面向对象的设计思想，我们首选思考的不是程序的执行流程，而是 <code>Student</code> 这种数据类型应该被视为一个对象<p>而这个<strong>对象</strong>拥有 <code>name</code> 和 <code>score</code> 这两个<strong>属性（Property）</strong><blockquote><p>属性是对象的特性或数据，可以通过点（ <code>.</code> ）操作符来访问<p>而在 Python 中属性分为<strong>俩种属性</strong>：<strong>类属性和实例属性</strong></blockquote><p>而调用<strong>对象</strong>对应的关联函数，我们称之为<strong>对象的方法（Method）</strong><hr><p><strong>类</strong>（Class）是一种抽象概念，比如我们定义的 Class——Student，是指学生这个概念，而<strong>实例</strong>（Instance）则是一个个具体的 Student<em> 比如，Bart Simpson 和 Lisa Simpson 是两个具体的 Student。</em><h2 id=类class和实例instance><a class=anchor href=#类class和实例instance>#</a> 类 (class) 和实例 (Instance)</h2><blockquote><p>类是<strong>抽象的模板</strong>，比如 Student 类，而实例是根据类创建出来的一个个<strong>具体的 “对象”</strong>，每个对象都<strong>拥有相同的方法</strong>，但各自的<strong>数据可能不同</strong>。</blockquote><h3 id=类的创建和实例化><a class=anchor href=#类的创建和实例化>#</a> 类的创建和实例化</h3><p>在 python 中通过关键字 <code>class</code> 定义一个类<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>	<span class="token keyword">pass</span></pre></table></figure><p>类名通常是大写开头的单词，紧接着是 <code>(object)</code> ，<strong>表示该类是从哪个类继承的</strong><blockquote><p>通常，如果<strong>没有合适的继承类</strong>，就使用 <code>object</code> 类，这是所有类最终都会继承的类</blockquote><p>类的<strong>实例化</strong>是指给类<strong>分配具体的对象</strong>：<blockquote><p>创建实例使用类名 + <code>()</code></blockquote><p><code>xiaohong = Student() # Student是类名</code><p>这样就创建了一个叫 <code>xiaohong</code> 的实例<hr><blockquote><h2 id=实例属性><a class=anchor href=#实例属性>#</a> 实例属性</h2></blockquote><p>可以自由地给一个实例变量绑定属性:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>xiaohong<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'honghong'</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>xiaohong<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre><span class="token comment"># honghong</span></pre></table></figure><blockquote><p>比如这里给实例 <code>xiaohong</code> 绑定了一个 <code>name</code> 属性</blockquote><p>由于<strong>类</strong>（<em>class</em>）可以<strong>起到模板的作用</strong>，因此，可以在创建实例的时候，把一些我们<strong>认为必须绑定的属性强制填写进去</strong>。通过定义一个特殊的 ** <code>__init__</code> 方法 **，在创建实例的时候，就把 <code>name</code> ， <code>score</code> 等属性绑上去：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre></table></figure><blockquote><p><code>__init__</code> 方法的第一个参数<strong>永远是 <code>self</code> </strong>，表示创建的实例本身<p>因此，在 <code>__init__</code> 方法内部，就可以把各种属性绑定到 <code>self</code> ，因为 <code>self</code> 就<strong>指向创建的实例本身</strong></blockquote><p><strong>类</strong>拥有了 <code>__init__</code> 方法，在创建<strong>实例</strong>的时候，就<strong>不能</strong>传入空的参数了，必须传入与 <code>__init__</code> 方法匹配的参数，但 ** <code>self</code> 不需要传 **，Python 解释器自己会把实例变量 (实例名) 传进去：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>xiaohong<span class="token punctuation">.</span>name<span class="token punctuation">,</span> xiaohong<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre><span class="token comment"># honghong 66</span></pre></table></figure><p>和普通的函数相比，在类中定义的函数<strong>只有一点不同</strong>，就是<strong>第一个参数永远是实例变量 <code>self</code> </strong>，并且，调用时，不用传递该参数<blockquote><p>除此之外，类的方法和普通函数没有什么区别，所以，你仍然可以用默认参数、可变参数、关键字参数和命名关键字参数。</blockquote><hr><blockquote><h2 id=类的方法><a class=anchor href=#类的方法>#</a> 类的方法</h2></blockquote><p>面向对象编程的一个重要特点就是数据封装<p>在上面的 <code>Student</code> 类中，每个实例就拥有各自的 <code>name</code> 和 <code>score</code> 这些数据 (<em>属性</em>)<p>我们可以进一步<strong>利用函数</strong>来<strong>获取</strong>这些对象的数据<blockquote><p>可以用放外面的函数进行访问:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>  self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>  self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre><span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">,</span> std<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>print_score<span class="token punctuation">(</span>xiaohong<span class="token punctuation">)</span></pre><tr><td data-num=14><td><pre><span class="token comment"># honghong:66</span></pre></table></figure><p>但是，既然 <code>Student</code> 实例本身就拥有这些数据，要访问这些数据，就没有必要从外面的函数去访问 (<em>而且代码庞杂，不够优雅</em>)</blockquote><p>这是我们就可以直接在 <code>Student</code> 类的内部定义访问数据的函数，这样，就把 “数据” 给封装起来了:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre><span class="token comment"># honghong:66</span></pre></table></figure><blockquote><p>这样就不用传入额外参数，代码简洁</blockquote><p>而这些封装数据的函数『<em>在类中定义的函数</em>』是和 <code>Student</code> 类本身是关联起来的，我们称之为<strong>类的方法</strong><blockquote><p>这样直接封装起来了，不需考虑内部逻辑</blockquote><h2 id=访问限制><a class=anchor href=#访问限制>#</a> 访问限制</h2><p>在我们定义的类（<em>class</em>）内部，有已经定义好的属性和方法<blockquote><p>而外部代码可以通过直接调用实例变量的方法来操作数据，这样，就隐藏了<strong>类</strong>内部的复杂逻辑</blockquote><p>但是从外部代码还是能自由的修改一个创建好的实例的 <code>name</code> 和 <code>score</code> 属性<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token string">'114514'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>xiaohong<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ahong'</span></pre><tr><td data-num=14><td><pre>xiaohong<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'1919810'</span></pre><tr><td data-num=15><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=16><td><pre><span class="token comment"># honghong:114514</span></pre><tr><td data-num=17><td><pre><span class="token comment"># ahong:1919810</span></pre></table></figure><blockquote><p>而这样的代码可以从外部更改类中数据，不够安全</blockquote><p>如果要让内部属性不被外部访问，可以把属性的名称前加上一个或两个下划线 <code>_</code> 或 <code>__</code><blockquote><p>但类似于 <code>__xxx__</code> 这样的称之为<strong>特殊变量</strong></blockquote><p>在 Python 中，实例的变量名如果以 <code>__</code> 开头，就变成了一个<strong>私有变量</strong>（<em>private</em>），只有内部可以访问，外部不能访问<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>__score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token string">'114514'</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>xiaohong<span class="token punctuation">.</span>__name<span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token comment"># 自然最后一行会报错</span></pre></table></figure><blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>File <span class="token string">"D:\AYunding\Python Learning\workplace\test_in_learning.py"</span><span class="token punctuation">,</span> line <span class="token number">12</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator"><</span>module<span class="token operator">></span></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>xiaohong<span class="token punctuation">.</span>__name<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre>    <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span></pre><tr><td data-num=5><td><pre>AttributeError<span class="token punctuation">:</span> <span class="token string">'Student'</span> <span class="token builtin">object</span> has no attribute <span class="token string">'__name'</span></pre></table></figure></blockquote><p>对于外部代码来说已经无法从外部访问 <code>实例变量.__name</code> 和 <code>实例变量.__score</code> 了，也就自然无法修改了<blockquote><p>但是，你也许会想，用原来的那种 <code>xiaohong.score=114514</code> 还是可以进行修改呀，但是这其实是创建了一个新的实例属性:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>  self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>  self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre><span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>__score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token string">'114514'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>xiaohong<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ahong'</span> <span class="token comment"># name 前加个_也一样</span></pre><tr><td data-num=14><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre><span class="token comment"># honghong:114514</span></pre><tr><td data-num=16><td><pre><span class="token comment"># honghong:114514</span></pre></table></figure><blockquote><p>如果改为 <code>xiaohong.__name</code> 结果还是不变，因为类中的 <code>__name</code> 变量和这里的实例变量不是一个变量</blockquote><p>调用原来的还是不变</blockquote><p>因为在创建<strong>私有变量</strong>（<em>private</em>）时，Python 解释器会将以双下划线开头、但结尾没有双下划线的变量名进行名称修饰（Name Mangling）<p>Python 会将这样的<strong>变量名</strong>修改为: <code>_ClassName__variable</code> 的形式<blockquote><p><code>ClassName</code> ：类名称， <code>variable</code> 变量名</blockquote><hr><p>所以有些时候，你看到了一个以下划线开头的实例变量名<p>这样的实例变量外部是可以访问的：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>__score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token string">'114514'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>xiaohong<span class="token punctuation">.</span>_Student__name <span class="token operator">=</span> <span class="token string">'ahong'</span></pre><tr><td data-num=14><td><pre>xiaohong<span class="token punctuation">.</span>_Student__score <span class="token operator">=</span> <span class="token string">'1919810'</span></pre><tr><td data-num=15><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=16><td><pre><span class="token comment"># honghong:114514</span></pre><tr><td data-num=17><td><pre><span class="token comment"># ahong:1919810</span></pre></table></figure><p>但是强烈建议你不要这么干，因为不同版本的 Python 解释器可能会把 <code>__name</code> 改成不同的变量名。<hr><p>但我们又想允许外部代码 (留个接口) 修改 <code>score</code> 怎么办？<p>可以再在类中添加一个方法，可供修改类中私有变量：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</pre><tr><td data-num=5><td><pre>        self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>__score<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre>    <span class="token keyword">def</span> <span class="token function">set_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>        self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score</pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre>xiaohong <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'honghong'</span><span class="token punctuation">,</span> <span class="token string">'114514'</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=16><td><pre>xiaohong<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">1919810</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre>xiaohong<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># honghong:114514</span></pre><tr><td data-num=19><td><pre><span class="token comment"># honghong:1919810</span></pre></table></figure><p>在方法中，也可以对传入的参数进行参数检查 ( <code>if</code> 等然后 <code>raise</code> 错误)<hr><p>总的来说就是，Python 本身没有任何机制阻止你干坏事，一切全靠开发者自己自觉<h2 id=继承和多态><a class=anchor href=#继承和多态>#</a> 继承和多态</h2><blockquote><h3 id=继承><a class=anchor href=#继承>#</a> 继承</h3></blockquote><p>在 OOP (面向对象) 程序设计中，当我们定义一个 class 的时候，可以从某个现有的 <code>class</code> 继承，新的 class 称为子类（<em>Subclass</em>），而被继承的 class 称为<strong>基类、父类或超类</strong>（Base class、Super class）。<p>比如我们定义一个类为 <code>Animal</code> , 其中有一个 <code>run()</code> 方法<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Python 这里会弱警告，因为定义的该函数并没有使用 self 相关的变量，没必要写成动态 加个 @staticmethod 即可解决</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Animal is running...'</span><span class="token punctuation">)</span></pre></table></figure><p>如果我们要再写俩个子类，可以自己从父类 (这里为 <code>Animal</code> ) 给继承<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 这里不再是 object 了</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">pass</span></pre></table></figure><p>此时，父类的所有方法都会继承到子类<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>dog <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre>cat <span class="token operator">=</span> Cat<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>dog<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre>cat<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token comment"># Animal is running...</span></pre><tr><td data-num=6><td><pre><span class="token comment"># Animal is running...</span></pre></table></figure><p>当然，子类还可以添加一些特殊的方法，如：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Animal is running...'</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dog is running...'</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=12><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Eating meat...'</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre>dog <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=16><td><pre>dog<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre>dog<span class="token punctuation">.</span>eat<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># Dog is running...</span></pre><tr><td data-num=19><td><pre><span class="token comment"># Eating meat...</span></pre></table></figure><p>这里还说明当子类和父类存在相同的方法时 (这里都存在相同的 <code>run()</code> 方法)<p><strong>子类</strong>的方法<strong>会覆盖</strong>父类的方法，在代码运行的时候总是会调用子类的方法<hr><blockquote><p>这样，我们就获得了继承的另一个好处：多态</blockquote><p>其实这样就定义了一种新的数据类型：类<blockquote><p>我们定义的数据类型和 Python 自带的其实没有什么太大区别</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=7><td><pre>    </pre><tr><td data-num=8><td><pre>b <span class="token operator">=</span> Animal<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre>c <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token comment"># 判断一个变量是某种类型可以用 isinstance ()</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre><span class="token comment"># True</span></pre><tr><td data-num=14><td><pre><span class="token comment"># True</span></pre></table></figure><blockquote><p>这里显示出 <code>c</code> 不仅仅是 <code>Dog</code> 还是它所继承的类 <code>Animal</code> 的类型</blockquote><p>所以，在继承关系中，如果一个实例的数据类型是某个子类，那它的数据类型也可以被看做是父类。但是，反过来就不行:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># False</span></pre></table></figure><p>还有一种展示多态的用法：<blockquote><p>将 <code>Animal</code> 这个类作为参数传入函数中</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Animal is running"</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Dog is running"</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre><span class="token keyword">def</span> <span class="token function">run_twice</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=12><td><pre>    animal<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>    animal<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre></pre><tr><td data-num=16><td><pre>run_twice<span class="token punctuation">(</span>Animal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre>run_twice<span class="token punctuation">(</span>Dog<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># Animal is running</span></pre><tr><td data-num=19><td><pre><span class="token comment"># Animal is running</span></pre><tr><td data-num=20><td><pre><span class="token comment"># Dog is running</span></pre><tr><td data-num=21><td><pre><span class="token comment"># Dog is running</span></pre></table></figure><p>传入的任意类型，只要是 <code>Animal</code> 类或者子类，就会自动调用实际类型的 <code>run()</code> 方法，这就是多态的意思：<p>对于一个变量，我们只需要知道它是 <code>Animal</code> 类型，无需确切地知道它的子类型，就可以放心地调用 <code>run()</code> 方法，而具体调用的 <code>run()</code> 方法是作用在 <code>Animal</code> 、 <code>Dog</code> 、 <code>Cat</code> 还是 <code>Tortoise</code> 对象上，由运行时该对象的确切类型决定，这就是多态真正的威力：调用方<strong>只管调用，不管细节</strong><p>只要确保 <code>run()</code> 这个方法编写正确即可，不用管是如何调用的<blockquote><p>这就是著名的 “开闭” 原则：<p>对扩展开放：允许新增 <code>Animal</code> 子类；<p>对修改封闭：不需要修改依赖 <code>Animal</code> 类型的 <code>run_twice()</code> 等函数。</blockquote><hr><blockquote><p>对于静态语言（例如 Java）来说，如果需要传入 <code>Animal</code> 类型（限制了传入参数必须是 <code>Animal</code> 类），则传入的对象必须是 <code>Animal</code> 类型或者它的子类，否则，将无法调用 <code>run()</code> 方法。<p>对于 Python 这样的<strong>动态语言</strong>来说，则不一定需要传入 <code>Animal</code> 类型。我们只需要保证传入的对象有一个 <code>run()</code> 方法就可以了：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Start...'</span><span class="token punctuation">)</span></pre></table></figure><blockquote><p>因为在 Python 中是没有限制传入参数的数据类型的，能传入字符串也能够传入<strong>类</strong>，只要有 <code>run()</code> 方法即可</blockquote></blockquote><h2 id=获取对象信息><a class=anchor href=#获取对象信息>#</a> 获取对象信息</h2><blockquote><p>当我们想拿到一个对象的引用的时候<p>可以采用 <code>type()</code> 去判断对象类型</blockquote><p>基本数据类型都可以用 <code>type()</code> 判断<p>也可以用 <code>type()</code> 判断函数和类：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>a <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 查看实例对象类型</span></pre><tr><td data-num=8><td><pre><span class="token comment"># &LTclass 'builtin_function_or_method'></span></pre><tr><td data-num=9><td><pre><span class="token comment"># &LTclass '__main__.Student'></span></pre></table></figure><blockquote><p>如果直接传入 <code>Student</code> 则会输出 <code>&LTclass 'type'></code> 这个元类</blockquote><p>可以在 <code>if</code> 语句中用 <code>type()</code> 判断俩个变量类型是否相同:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># True</span></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># True</span></pre></table></figure><p>判断基本数据类型可以直接写 <code>int</code> ， <code>str</code> 等<p>如果要判断是不是<strong>函数对象</strong>，则可以使用 <code>types</code> 模块中定义的常量 (类似 <code>int</code> 或者 <code>str</code> )：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> types</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token keyword">def</span> <span class="token function">student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span> <span class="token operator">==</span> types<span class="token punctuation">.</span>FunctionType<span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token comment"># True</span></pre></table></figure><blockquote><p>如果把 <code>student</code> 改为 <code>student()</code> 的话，因为 <code>student</code> 是函数对象<p>而 <code>student()</code> 是执行函数并返回返回值，所以结果会是 <code>False</code></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> types</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">)</span> <span class="token operator">==</span> types<span class="token punctuation">.</span>BuiltinMethodType<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># 注意内置函数方法和自创函数不是同一类型</span></pre></table></figure><hr><blockquote><h3 id=isinstance><a class=anchor href=#isinstance>#</a> <code>isinstance()</code></h3></blockquote><p><strong>用于检查一个对象是否是指定类的实例，或者是否是指定类的子类的实例。</strong><p>使用 <code>isinstance()</code> 可以实现上述内容去判断类型<p>而要是判断 class 的继承关系<blockquote><p><code>type()</code> 不考虑类之间的继承关系</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>Dog<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token comment"># True</span></pre></table></figure><blockquote><p>这里是用的<strong>指定类的实例，或指定类的子类的实例</strong>进行判断<p>若要<strong>类与类</strong>进行判断，可以用 ** <code>issubclass()</code> ** 函数</blockquote><p>可以用于判断继承链『能用 <code>type()</code> 判断的基本类型也可以用 <code>isinstance()</code> 进行判断』<p>并且 <code>isinstance()</code> 还可以判断一个变量是否是某些类型中的一种<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre><span class="token comment"># True</span></pre><tr><td data-num=4><td><pre><span class="token comment"># True</span></pre></table></figure><blockquote><h4 id=dir><a class=anchor href=#dir>#</a> <code>dir()</code></h4></blockquote><p>如果需要<strong>获得</strong>一个对象的<strong>所有属性和方法</strong>，可以使用 <code>dir()</code> 函数，它返回一个包含字符串的 <code>list</code> ：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># ['__add__', '__class__', '__contains__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getnewargs__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__mod__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__rmod__', '__rmul__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', 'capitalize', 'casefold', 'center', 'count', 'encode', 'endswith', 'expandtabs', 'find', 'format', 'format_map', 'index', 'isalnum', 'isalpha', 'isascii', 'isdecimal', 'isdigit', 'isidentifier', 'islower', 'isnumeric', 'isprintable', 'isspace', 'istitle', 'isupper', 'join', 'ljust', 'lower', 'lstrip', 'maketrans', 'partition', 'removeprefix', 'removesuffix', 'replace', 'rfind', 'rindex', 'rjust', 'rpartition', 'rsplit', 'rstrip', 'split', 'splitlines', 'startswith', 'strip', 'swapcase', 'title', 'translate', 'upper', 'zfill']</span></pre></table></figure><blockquote><p><code>__xx__</code> 为<strong>方法</strong>，其他可以以 <code>.</code> 操作符访问的为<strong>属性</strong></blockquote><p><strong>实际上</strong>，方法也可以用 <code>.</code> 操作符访问：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre><span class="token comment"># 3</span></pre><tr><td data-num=4><td><pre><span class="token comment"># 3</span></pre></table></figure><hr><p>要对我们自己创建的<strong>类</strong>使用方法的话，必须自己在类中添加：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Mycat</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>a <span class="token operator">=</span> Mycat<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre>a<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># 100</span></pre></table></figure><hr><blockquote><h3 id=测试对象属性和方法><a class=anchor href=#测试对象属性和方法>#</a> 测试对象属性和方法</h3></blockquote><p>使用 <code>getattr()</code> 、 <code>setattr()</code> 以及 <code>hasattr()</code> ，直接对对象的属性和方法进行操作：<blockquote><p>这里以实例对象为例</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">9</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">power</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">*</span> self<span class="token punctuation">.</span>x</pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre>oj <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># oj 这个实例对象有属性 'x' 吗？</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 有属性 'y' 吗</span></pre><tr><td data-num=12><td><pre><span class="token builtin">setattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>  <span class="token comment"># 对 oj 这个实例对象设置属性 'y' 并赋值为 19</span></pre><tr><td data-num=13><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 再次访问</span></pre><tr><td data-num=14><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>oj<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取 oj 的属性 'y'(俩种方法一致)</span></pre><tr><td data-num=15><td><pre><span class="token comment"># True</span></pre><tr><td data-num=16><td><pre><span class="token comment"># False</span></pre><tr><td data-num=17><td><pre><span class="token comment"># True</span></pre><tr><td data-num=18><td><pre><span class="token comment"># 19 19</span></pre></table></figure><p>如果用 <code>getattr()</code> 获取对象中不存在的属性，则会抛出 <code>AttributeError</code> （属性错误）的错误<p>要想指定错误类型，可以修改参数 (默认为 <code>default</code> )<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># 404</span></pre></table></figure><p>对<strong>方法</strong>（<em>Method</em>）也是适用的<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'power'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 有无 'power' 这个方法</span></pre><tr><td data-num=2><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'power'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取 'power' 这个方法</span></pre><tr><td data-num=3><td><pre>fn <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>oj<span class="token punctuation">,</span> <span class="token string">'power'</span><span class="token punctuation">)</span>  <span class="token comment"># 获取方法 'power' 并赋值到变量 fn</span></pre><tr><td data-num=4><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 访问 fn</span></pre><tr><td data-num=5><td><pre><span class="token comment"># True</span></pre><tr><td data-num=6><td><pre><span class="token comment"># &LTbound method MyObject.power of <__main__.MyObject object at 0x0000019C8825FE50>></span></pre><tr><td data-num=7><td><pre><span class="token comment"># 81 (因为传入的是类里面定义的变量 9)</span></pre></table></figure><hr><p>要注意的是，只有在不知道对象信息的时候，我们才会去获取对象信息。如果可以直接写：<blockquote><p>已经能知道有没有这个属性的情况下，直接用 <code>.</code> 操作符调用<p>不知道存不存在再用 <code>getattr</code></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token builtin">sum</span> <span class="token operator">=</span> oj<span class="token punctuation">.</span>y <span class="token operator">+</span> oj<span class="token punctuation">.</span>y</pre></table></figure><p>就不要写:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span></pre></table></figure><blockquote><p>一个正确的用法的例子如下：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">def</span> <span class="token function">readImage</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre><span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">'read'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>  <span class="token keyword">return</span> readData<span class="token punctuation">(</span>fp<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token keyword">return</span> <span class="token boolean">None</span></pre></table></figure><p>这里写了一个从文件流 <code>fp</code> 中读取图像的函数，首先要判断该 fp 对象是否存在 read 方法，如果存在，则该对象是一个流，如果不存在，则无法读取。 <code>hasattr()</code> 就派上了用场。<blockquote><p>注意：有 <code>read()</code> 方法，不代表该 fp 对象就是一个文件流，它也可能是网络流，也可能是内存中的一个字节流，但只要 <code>read()</code> 方法返回的是有效的图像数据，就不影响读取图像的功能。</blockquote></blockquote><h2 id=实例属性和类属性><a class=anchor href=#实例属性和类属性>#</a> 实例属性和类属性</h2><p>给实例绑定属性的方法是通过实例变量，或者通过 <code>self</code> 变量<p>但是如果<strong>类</strong>本身需要绑定一个属性的话，可以直接在<strong>类</strong> (<em>class</em>) 中直接去定义<p>这种属性就叫做<strong>类属性</strong>，供<strong>类</strong> (<em>class</em>) 所有『其他实例都可以进行访问』<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    name <span class="token operator">=</span> <span class="token string">'Student'</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 打印类属性</span></pre><tr><td data-num=8><td><pre><span class="token comment"># Student</span></pre><tr><td data-num=9><td><pre><span class="token comment"># Student</span></pre></table></figure><blockquote><p>这样的就不需要额外传入参数特殊指定</blockquote><p>如果再给实例对象绑定同名对象<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    name <span class="token operator">=</span> <span class="token string">'Student'</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 打印 name 属性，因为实例并没有 name 属性，所以会继续查找 class 的 name 属性</span></pre><tr><td data-num=7><td><pre>std<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span></pre><tr><td data-num=8><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token comment"># Student</span></pre><tr><td data-num=10><td><pre><span class="token comment"># Michael</span></pre></table></figure><p>这里对 <code>std</code> 这个实例对象绑定了与<strong>类同名</strong>的<strong> name</strong> 属性，由于<strong>实例属性优先级比类属性高</strong>，因此，它会屏蔽掉类的 <code>name</code> 属性<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 但是类属性不会被覆盖</span></pre><tr><td data-num=2><td><pre><span class="token comment"># Student</span></pre></table></figure><blockquote><p><code>del</code> 可以删除属性：</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">del</span> std<span class="token punctuation">.</span>name <span class="token comment"># 删除 name 属性</span></pre><tr><td data-num=2><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 由于找不到示例的 name 属性，自动调用类属性</span></pre><tr><td data-num=3><td><pre><span class="token comment"># Student</span></pre></table></figure><p>所有在编写程序的时候，<strong>千万不要</strong>对实例属性和类属性<strong>使用相同的名字</strong>，因为相同名称的实例属性将屏蔽掉类属性，但是当你删除实例属性后，再使用相同的名称，访问到的将是类属性。<blockquote><p>如果在 <code>__init__</code> 方法中调用类属性，则每一次实例化都会修改类属性 (<em>因为每一次实例化都必须访问 <code>__init__</code> 方法</em>):<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>count <span class="token operator">=</span> <span class="token number">0</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>  self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=6><td><pre>  Student<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span></pre></table></figure><p>这样，也可以统计创建的实例的数量</blockquote><h1 id=面向对象高级编程><a class=anchor href=#面向对象高级编程>#</a> 面向对象高级编程</h1><h2 id=类的本源><a class=anchor href=#类的本源>#</a> 类的本源</h2><p>在 Python 中一切皆对象，包括类（<em>class</em>），而类名则代表类这个对象名 <code>()</code> 中指代继承的<strong>类</strong>名，例：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre></table></figure><blockquote><p>在这里继承的是<strong>所有类的基类</strong> <code>object</code></blockquote><p>如果使用 <code>type()</code> 查询类对象的话<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># &LTclass 'type'></span></pre></table></figure><p>会返回这个类的元类 (因为不考虑继承关系，可以再创建一个 <code>Dog</code> 类继承自 <code>Animal</code> 类从而验证)<blockquote><p>而这里返回的<strong>元类</strong> <code>type</code> 其实是包含在基类 <code>object</code> 中的<p>因为所有的类，包括 <code>type</code> 和用户自定义的类，都是 <code>object</code> 的<strong>实例</strong><p>大多数情况下，如果没有显示地指定<strong>元类</strong>则 Python 会默认以 <code>type</code> 作为默认的元类<blockquote><p><strong>元类</strong>在后面会进行介绍</blockquote></blockquote><h2 id=使用__slots__><a class=anchor href=#使用__slots__>#</a> 使用 <code>__slots__</code></h2><blockquote><h4 id=限制对象属性及方法><a class=anchor href=#限制对象属性及方法>#</a> 限制对象属性及方法</h4></blockquote><p>正常情况下，当我们定义了一个 class，创建了一个 class 的实例后，我们可以给该实例<strong>绑定任何属性和方法</strong>（在外部进行绑定），这就是动态语言的灵活性：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">from</span> types <span class="token keyword">import</span> MethodType</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre><span class="token keyword">def</span> <span class="token function">set_age</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>    self<span class="token punctuation">.</span>age <span class="token operator">=</span> age</pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>std<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span> <span class="token comment"># 直接对实例绑定 name 属性</span></pre><tr><td data-num=14><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>std<span class="token punctuation">.</span>set_age <span class="token operator">=</span> MethodType<span class="token punctuation">(</span>set_age<span class="token punctuation">,</span> std<span class="token punctuation">)</span> <span class="token comment"># 借用方法类型函数给 std 这个实例绑定上 set_age 方法</span></pre><tr><td data-num=16><td><pre>std<span class="token punctuation">.</span>set_age<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>age<span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># Michael</span></pre><tr><td data-num=19><td><pre><span class="token comment"># 25</span></pre></table></figure><p>给一个实例绑定的方法，对另一个实例是不起作用的<blockquote><p>所以这只适用于给特殊的实例绑定方法和属性</blockquote><hr><p>要想给所有实例绑定方法，可以直接给<strong>类</strong> (<em>class</em>) 绑定方法:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre><span class="token keyword">def</span> <span class="token function">set_age</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    self<span class="token punctuation">.</span>age <span class="token operator">=</span> age</pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre>Student<span class="token punctuation">.</span>set_age <span class="token operator">=</span> set_age</pre><tr><td data-num=10><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre>std<span class="token punctuation">.</span>set_age<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>age<span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre><span class="token comment"># 25</span></pre></table></figure><blockquote><p>这样的直接给类绑定方法和上面给类绑定属性的做法<strong>并不规范</strong>（会有警告）<p>因为 Python 通常建议在<strong>类体内</strong>定义方法，而不是在外部绑定方法。这样的做法并不规范</blockquote><hr><blockquote><h4 id=使用__slots__限制实例属性><a class=anchor href=#使用__slots__限制实例属性>#</a> 使用 <code>__slots__</code> 限制实例属性</h4></blockquote><p>如果我们想要<strong>限制</strong>某个实例<strong>在外部添加的属性</strong><p>而 Python 允许在定义 class 的时候，定义一个特殊的 <code>__slots__</code> 变量 (<em>类特性</em>)，来限制该 class 实例能添加的属性：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Micheal'</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># Micheal</span></pre></table></figure><p>当我们在<strong>类外</strong>规定 <code>__slots__</code> 变量以外的属性：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'99'</span></pre><tr><td data-num=2><td><pre>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'99'</span></pre><tr><td data-num=4><td><pre>    <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span></pre><tr><td data-num=5><td><pre>AttributeError<span class="token punctuation">:</span> <span class="token string">'Student'</span> <span class="token builtin">object</span> has no attribute <span class="token string">'score'</span></pre></table></figure><blockquote><p>表示 Student 这个对象中没有 score 这个属性</blockquote><p>由于 <code>'score'</code> 没有被放到 <code>__slots__</code> 中，所以不能绑定 <code>score</code> 属性，试图绑定 <code>score</code> 将得到 <code>AttributeError</code> 的错误。<p>这样可以做到在外部<strong>不能</strong>对实例随意的添加属性<blockquote><p>使用 <code>__slots__</code> 要注意， <code>__slots__</code> 定义的属性仅对当前类实例起作用，对继承的子类是不起作用的：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>__slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre><span class="token keyword">class</span> <span class="token class-name">Higher</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre><span class="token keyword">pass</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre>higher <span class="token operator">=</span> Higher<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre>higher<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'99'</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>higher<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token comment"># 99</span></pre></table></figure><p>除非在子类中也定义 <code>__slots__</code> ，这样，子类实例允许定义的属性就是自身的 <code>__slots__</code> 加上父类的 <code>__slots__</code><p>如把父类 <code>__slots__</code> 里面加上 <code>score</code> ：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>__slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre><span class="token keyword">class</span> <span class="token class-name">Higher</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>__slots__ <span class="token operator">=</span> <span class="token string">'age'</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre>higher <span class="token operator">=</span> Higher<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre>higher<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'99'</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>higher<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token comment"># 99</span></pre><tr><td data-num=13><td><pre><span class="token comment">## 并不会报错</span></pre></table></figure><p><strong>证明</strong>子类只要有 <code>__slots__</code> 就也会继承父类的 <code>__slots__</code></blockquote><hr><blockquote><h3 id=类外定义属性和方法><a class=anchor href=#类外定义属性和方法>#</a> 类外定义属性和方法</h3></blockquote><p>在类外定义属性和方法有一些好处，比如类外定义属性的话，实例化的时候就不必即时传入参数，但对每个都需要传入参数的对象而言，还是在类中定义<h2 id=使用property><a class=anchor href=#使用property>#</a> 使用 <code>@property</code></h2><blockquote><h4 id=property其实就是个访问器getter><a class=anchor href=#property其实就是个访问器getter>#</a> <code>@property</code> 其实就是个<strong>访问器</strong>（<em>Getter</em>）</h4></blockquote><p>在绑定属性时，如果我们直接把属性暴露出去，虽然写起来很简单，但是，没办法检查参数，导致可以把成绩随便改<blockquote><p>上面的外部给实例添加属性的弊端</blockquote><p>这时，你可能就会想去设置私有变量，以防从外部进行修改，只能够从内部进行（调用内部函数）:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">get_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score</pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>    <span class="token keyword">def</span> <span class="token function">set_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'score must be an integer!'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre>        <span class="token keyword">if</span> value <span class="token operator"><</span> <span class="token number">0</span> <span class="token keyword">or</span> value <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'score must between 0 ~ 100!'</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre>        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value</pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>std<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></pre><tr><td data-num=16><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>get_score<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre><span class="token comment"># 60</span></pre><tr><td data-num=18><td><pre>std<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span></pre><tr><td data-num=19><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>get_score<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 超出范围报错</span></pre><tr><td data-num=20><td><pre><span class="token comment">#Traceback (most recent call last):</span></pre><tr><td data-num=21><td><pre><span class="token comment">#   std.set_score(999)</span></pre><tr><td data-num=22><td><pre><span class="token comment"># File "D:\AYunding\Python Learning\workplace\test1.py", line 10, in set_score</span></pre><tr><td data-num=23><td><pre><span class="token comment">#   raise ValueError('score must between 0 ~ 100!')</span></pre><tr><td data-num=24><td><pre><span class="token comment">#ValueError: score must between 0 ~ 100!</span></pre></table></figure><blockquote><p>但这种方法略显复杂，要利用两个函数进行设置和调用的功能</blockquote><hr><p>这时我们就要用上 Python 内置的访问器 <code>@property</code> （<em>Getter</em>）了『本质还是装饰器』：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token decorator annotation punctuation">@property</span></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score</pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>    <span class="token decorator annotation punctuation">@score<span class="token punctuation">.</span>setter</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value</pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre>std<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'114514'</span></pre><tr><td data-num=13><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=14><td><pre><span class="token comment"># 114514</span></pre></table></figure><blockquote><p><strong>注意</strong>：这里的 <code>self._score</code> 私有变量不能写成 <code>self.score</code> 公共变量<p><strong>否则</strong>会被无限地递归调用 (先是调用 <code>setter</code> 方法，在 <code>setter</code> 方法中，又触发了 <code>@property</code> 修饰的 <code>getter</code> 方法『因为同名』，而这个 <code>getter</code> 方法中又有 <code>return self.score</code> ，于是又会调用相同的 <code>getter</code> 方法，如此往复，形成无限递归。)</blockquote><p>把一个 getter 方法变成属性，只需要加上 <code>@property</code> 就可以了，此时， <code>@property</code> 本身又创建了另一个装饰器 <code>@score.setter</code> ，<strong>负责把一个 <code>setter</code> 方法变成属性赋值</strong>，于是，我们就拥有一个可控的属性操作<p>因为有 <code>@property</code> , 所以我们在对实例属性操作的时候，就知道该属性很可能不是直接暴露的，而是通过 getter 和 setter 方法来实现的。<hr><blockquote><p>我们可以使用 @property 装饰器来创建<strong>只读属性</strong>，@property 装饰器会将<strong>方法</strong>转换为相同名称的<strong>只读属性</strong>，可以与所定义的属性配合使用，这样可以防止属性被修改。</blockquote><p>还可以定义只读属性，只定义 getter 方法，不定义 setter 方法就是一个只读属性:<blockquote><p><strong>只能</strong>被调用，参数<strong>不能</strong>被修改<p><strong> <code>@property</code> 修饰方法，使方法可以像属性一样访问。</strong><p>而 <code>setter</code> 则是给予一种能修改 <code>@property</code> 值的方法 (能够合法修改，而不是外部随意修改)</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token decorator annotation punctuation">@property</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">def</span> <span class="token function">birth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_birth</pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>    <span class="token decorator annotation punctuation">@birth<span class="token punctuation">.</span>setter</span></pre><tr><td data-num=8><td><pre>    <span class="token keyword">def</span> <span class="token function">birth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>        self<span class="token punctuation">.</span>_birth <span class="token operator">=</span> value</pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>    <span class="token decorator annotation punctuation">@property</span></pre><tr><td data-num=12><td><pre>    <span class="token keyword">def</span> <span class="token function">age</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=13><td><pre>        <span class="token keyword">return</span> <span class="token number">2015</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>_birth</pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre></pre><tr><td data-num=16><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre>std<span class="token punctuation">.</span>birth <span class="token operator">=</span> <span class="token number">1997</span></pre><tr><td data-num=18><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>age<span class="token punctuation">)</span></pre><tr><td data-num=19><td><pre><span class="token comment"># 18</span></pre></table></figure><p>上面的 <code>birth</code> 是可读写属性，而 <code>age</code> 就是一个<em>只读</em>属性<blockquote><p>因为 <code>age</code> 能通过 <code>birth</code> 得来，因而我们不需要规定 <code>age</code></blockquote><hr><p>要特别注意：<strong>属性</strong>的方法名不要和<strong>实例变量</strong>重名:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 这样的代码是错误的</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>    <span class="token comment"># 方法名称和实例变量均为 birth:</span></pre><tr><td data-num=4><td><pre>    <span class="token decorator annotation punctuation">@property</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">birth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>birth</pre><tr><td data-num=7><td><pre>    </pre><tr><td data-num=8><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre>s<span class="token punctuation">.</span>birth</pre><tr><td data-num=10><td><pre><span class="token comment"># 报错</span></pre></table></figure><p>因为这样调用 <code>s.birth</code> 时，首先转换为方法调用 (先调取函数)，然后执行到<p><code>return self.birth</code> 时，又视为访问 <code>self</code> 的<strong>属性</strong>，导致又调取了本函数，造成无限递归，最终导致栈溢出报错 <code>RecursionError</code> 。<blockquote><p>与上面的原理一致</blockquote><hr><blockquote><h5 id=xxxdeleter><a class=anchor href=#xxxdeleter>#</a> <code>@XXX.deleter</code></h5></blockquote><p>除了 <code>setter</code> 方法设置属性外，还可以使用 <code>deleter</code> 装饰器来<strong>删除指定属性</strong> (因为变量被设置为了私有变量，无法在外部直接 <code>del</code> 删除)：<blockquote><p><code>deleter</code> 装饰器装饰的方法就可以被使用 <code>del</code> 来<strong>删除</strong>对应的属性</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> <span class="token number">0</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token decorator annotation punctuation">@property</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score</pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre>    <span class="token decorator annotation punctuation">@score<span class="token punctuation">.</span>setter</span></pre><tr><td data-num=10><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value</pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre>    <span class="token decorator annotation punctuation">@score<span class="token punctuation">.</span>deleter</span></pre><tr><td data-num=14><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=15><td><pre>        <span class="token keyword">del</span> self<span class="token punctuation">.</span>_score</pre><tr><td data-num=16><td><pre></pre><tr><td data-num=17><td><pre></pre><tr><td data-num=18><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=19><td><pre>std<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'114514'</span></pre><tr><td data-num=20><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=21><td><pre><span class="token keyword">del</span> std<span class="token punctuation">.</span>score <span class="token comment"># 用 del 删除 score 属性</span></pre><tr><td data-num=22><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=23><td><pre><span class="token comment"># 114514</span></pre><tr><td data-num=24><td><pre><span class="token comment"># 报错，为：AttributeError: 'Student' object has no attribute '_score'.</span></pre></table></figure><hr><p>最大作用还是<strong>与所定义的属性配合使用，这样可以防止属性被修改</strong><blockquote><p>由于 Python 进行属性的定义时，没办法设置私有属性，因此要通过 <code>@property</code> 的方法来进行设置。这样可以隐藏属性名，让用户进行使用的时候无法随意修改。</blockquote><h2 id=多重继承><a class=anchor href=#多重继承>#</a> 多重继承</h2><blockquote><p>就是一个子类可以继承多个父类以获取全部父类的<strong>所有功能</strong> (<em>方法</em>)</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># 定义一个简单的 Mixin 类</span></pre><tr><td data-num=2><td><pre><span class="token keyword">class</span> <span class="token class-name">LoggingMixin</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Log: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre><span class="token comment"># 主要的类，包含一些基本功能</span></pre><tr><td data-num=8><td><pre><span class="token keyword">class</span> <span class="token class-name">Calculator</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>        <span class="token keyword">return</span> a <span class="token operator">+</span> b</pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre><span class="token comment"># 使用 Mixin 扩展 Calculator 类</span></pre><tr><td data-num=14><td><pre><span class="token keyword">class</span> <span class="token class-name">LoggedCalculator</span><span class="token punctuation">(</span>LoggingMixin<span class="token punctuation">,</span> Calculator<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=15><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=16><td><pre></pre><tr><td data-num=17><td><pre></pre><tr><td data-num=18><td><pre><span class="token comment"># 创建 LoggedCalculator 实例并使用扩展功能</span></pre><tr><td data-num=19><td><pre>calculator <span class="token operator">=</span> LoggedCalculator<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=20><td><pre>result <span class="token operator">=</span> calculator<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></pre><tr><td data-num=21><td><pre>calculator<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Result: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></pre><tr><td data-num=22><td><pre><span class="token comment"># Log: Result: 15</span></pre></table></figure><p>在设计类的继承关系时，通常，主线都是单一继承下来的<p>例如上面 <code>LoggedCalculator</code> 这个类继承自 <code>Calculator</code> ，但是又需要 "混入" 额外的功能 <code>Logging</code> ，那么通过多重继承就可以实现<p>这种设计模式就称为 <code>Mixln</code><p>为了更好地看出继承关系，被 "混入" 的我们习惯于后缀加个 <code>Mixln</code><p>当然，一个子类可以有多个 <code>Mixln</code><p><code>Mixln</code> 的目的就是给一个类增加多个功能，这样，在设计类的时候，我们优先考虑通过多重继承来组合多个 <code>MixIn</code> 的功能，而不是设计多层次的复杂的继承关系。<blockquote><p>由于 Python 允许使用多重继承，因此， <code>MixIn</code> 就是一种常见的设计。</blockquote><h2 id=定制类class><a class=anchor href=#定制类class>#</a> 定制类 (<em>class</em>)</h2><p>看到类似 <code>__slots__</code> 这种形如 <code>__xxx__</code> 的变量或者函数名就要注意，这些在 Python 中是有特殊用途的<p>除了上面介绍的 <code>__slots__</code> 和 <code>__len__()</code> 方法以外，Python 的<em> class</em> 中还有许多这样有特殊用途的函数，可以帮助我们<strong>定制类</strong><blockquote><h3 id=__str__><a class=anchor href=#__str__>#</a> <code>__str__</code></h3></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Micheal'</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># <__main__.Student object at 0x000001EA7BF60610></span></pre></table></figure><p>如果<strong>直接打印</strong>实例对象会出来对象的内存地址<p>这时我们就可以用 <code>__str__</code> 方法，将一个<strong>类的实例变为字符串</strong> (<em>str</em>)<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Micheal'</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre><span class="token comment"># Micheal</span></pre></table></figure><blockquote><p>打印时自动返回 <code>return</code> 内容</blockquote><hr><p>但是如果我们用的是<strong> Python 解释器</strong> (<em>Python 终端又或者 Python 控制台</em>)<p>则我们直接键入 <code>std</code> 出来的还是实例对象和内存地址<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token operator">>></span><span class="token operator">></span> s</pre><tr><td data-num=2><td><pre><span class="token operator"><</span>__main__<span class="token punctuation">.</span>Student <span class="token builtin">object</span> at <span class="token number">0x109afb310</span><span class="token operator">></span></pre></table></figure><p>这是因为直接显示变量调用的不是 <code>__str__()</code> ，而是 <code>__repr__()</code> ，两者的区别是 <code>__str__()</code> 返回用户看到的字符串 (<strong>编译器下方直接显示的内容</strong>)，而 <code>__repr__()</code> 返回程序<strong>开发者看到的字符串</strong> (Python 解释器的内容)，也就是说， <code>__repr__()</code> 是<strong>为调试服务</strong>的。<p>这时我们可以加一行代码：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre>    __repr__ <span class="token operator">=</span> __str__</pre></table></figure><blockquote><p>由于通常 <code>__str__()</code> 和 <code>__repr__()</code> 代码都是一样的，所以可以这样写</blockquote><hr><blockquote><h3 id=__iter__><a class=anchor href=#__iter__>#</a> <code>__iter__</code></h3></blockquote><blockquote><blockquote><p>用于迭代の方法，可以使类被 <code>for in</code> 循环迭代<p>要配合 <code>__next__</code> ，还必须加上条件和退出 <code>StopIteration</code> ，否则将一直迭代下去被 <code>for in</code> 调用</blockquote></blockquote><p>如果一个类想被用于 <code>for ... in</code> 循环，类似 list 或 tuple 那样，就必须实现一个 <code>__iter__()</code> 方法，该方法返回一个<strong>可迭代对象</strong>，然后，Python 的 for 循环就会不断调用该迭代对象的 <code>__next__()</code> 方法拿到循环的下一个值，直到遇到 ** <code>StopIteration</code> <strong> 错误时</strong>退出循环 **。<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> self</pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre>    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b</pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">:</span></pre><tr><td data-num=12><td><pre>            <span class="token keyword">raise</span> StopIteration</pre><tr><td data-num=13><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a</pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre></pre><tr><td data-num=16><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=17><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987</span></pre></table></figure><blockquote><h3 id=__getitem__><a class=anchor href=#__getitem__>#</a> <code>__getitem__</code></h3></blockquote><p>上面仅仅是实现<strong>可迭代的</strong>方法<p>但上面的 <code>Fib</code> 类还不能像 <code>list</code> 一样可供索引<p>所以我们可以用 <code>__getitem__</code> 方法，实现将<strong>类的实例对象</strong>变为可索引<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>            self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b</pre><tr><td data-num=8><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a</pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>fib <span class="token operator">=</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre><span class="token comment"># 2</span></pre></table></figure><blockquote><p>原理为，对象传入索引值 (<em>item</em>)，然后利用 <code>for</code> 循环，将值一遍遍覆盖然后输出 <code>self.a</code></blockquote><hr><p>但是 list 有个神奇的切片方法<p>对于 Fib 却报错：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>TypeError<span class="token punctuation">:</span> <span class="token string">'slice'</span> <span class="token builtin">object</span> cannot be interpreted <span class="token keyword">as</span> an integer</pre></table></figure><p>因为上面的 <code>item</code> 是 <code>int</code> 类型，传入的是单个索引值（ <code>item</code> 只能是单个值，而不是<strong>可变参数</strong>，而且如果改成可变参数， <code>self.a</code> 也只会储存最后一次数据，达不到切片返回的 <code>list</code> 的目的）<p>所以我们得对传入的数据类型进行转换<blockquote><p>即把传入的 <code>slice</code> 处理为单个 <code>list</code> 然后分别让 <code>for</code> 循环进行调用并返回 <code>list</code></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>                self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b</pre><tr><td data-num=9><td><pre>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>a</pre><tr><td data-num=10><td><pre>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token builtin">slice</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>            start <span class="token operator">=</span> item<span class="token punctuation">.</span>start</pre><tr><td data-num=12><td><pre>            stop <span class="token operator">=</span> item<span class="token punctuation">.</span>stop</pre><tr><td data-num=13><td><pre>            <span class="token keyword">if</span> start <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre><tr><td data-num=14><td><pre>                start <span class="token operator">=</span> <span class="token number">0</span></pre><tr><td data-num=15><td><pre>            L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre><tr><td data-num=16><td><pre>            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=17><td><pre>                self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b</pre><tr><td data-num=18><td><pre>                L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>a<span class="token punctuation">)</span></pre><tr><td data-num=19><td><pre>            self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment"># 这里把 a，b 值重置，使得能被反复重新调用</span></pre><tr><td data-num=20><td><pre>            <span class="token keyword">return</span> L<span class="token punctuation">[</span>start<span class="token punctuation">:</span>stop<span class="token punctuation">]</span></pre><tr><td data-num=21><td><pre></pre><tr><td data-num=22><td><pre></pre><tr><td data-num=23><td><pre></pre><tr><td data-num=24><td><pre>fib <span class="token operator">=</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=25><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=26><td><pre><span class="token comment"># [1, 1, 2, 3, 5]</span></pre><tr><td data-num=27><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=28><td><pre><span class="token comment"># [2, 3, 5, 8]</span></pre><tr><td data-num=29><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=30><td><pre><span class="token comment"># [1, 1, 2, 3, 5, 8]</span></pre></table></figure><blockquote><p>但是这个类似的但是没有对 step 参数作处理，也没有对负数作处理，所以，要正确实现一个 <code>__getitem__()</code> 还是有很多工作要做的。</blockquote><p>此外，如果把对象看成 <code>dict</code> ， <code>__getitem__()</code> 的参数也可能是一个可以作 <code>key</code> 的 <code>object</code> ，例如 <code>str</code><p>与之对应的是 <code>__setitem__()</code> 方法，把对象视作 <code>list</code> 或 <code>dict</code> 来对集合赋值。最后，还有一个 <code>__delitem__()</code> 方法，用于删除某个元素。<blockquote><p>总之，通过上面的方法，我们自己定义的类表现得和 Python 自带的 list、 <code>tuple</code> 、 <code>dict</code> 没什么区别，这完全归功于动态语言的 “鸭子类型”，不需要强制继承某个接口。</blockquote><hr><blockquote><h3 id=__getattr__><a class=anchor href=#__getattr__>#</a> <code>__getattr__</code></h3></blockquote><p>正常情况下，当我们调用类的<strong>方法或属性</strong>时，如果不存在，就会报错。<p>而为了可以避免这个错误，除了可以加上一个 <code>score</code> 属性外，Python 还有另一个机制，那就是写一个 <code>__getattr__()</code> 方法，动态返回一个属性:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token string">'score'</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>            <span class="token keyword">return</span> <span class="token number">99</span></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>score<span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token comment"># 99</span></pre></table></figure><blockquote><p>当调用不存在的属性（这里是 <code>score</code> ）Python 解释器会试图调用 <code>__getattr__(self, 'score')</code> 来尝试获得属性，这样，我们就有机会返回 <code>score</code> 的值</blockquote><p>当然也可以返回函数 (这里用的是 <code>lambda</code> 匿名函数)：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token string">'age'</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>            <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token number">25</span></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>age<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token comment"># 25</span></pre></table></figure><blockquote><p>调用方法也是和之前一样的方式</blockquote><p>注意，只有在没有找到属性的情况下，才调用 <code>__getattr__</code> ，已有的属性，比如 <code>name</code> ，不会在 <code>__getattr__</code> 中查找。<p>此外，注意到任意调用如 <code>s.abc</code> 都会返回 <code>None</code> ，这是因为我们定义的 <code>__getattr__</code> 默认返回就是 <code>None</code> 。要让 class 只响应特定的几个属性，我们就要按照约定，抛出 <code>AttributeError</code> 的错误：<blockquote><p>这样就不用一个一个写入错误提示</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token string">'age'</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>            <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token number">25</span></pre><tr><td data-num=5><td><pre>        <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">'\'Student\' object has no attribute \'%s\''</span> <span class="token operator">%</span> item<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>age<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>abc<span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre><span class="token comment"># 25</span></pre><tr><td data-num=12><td><pre><span class="token comment"># AttributeError: 'Student' object has no attribute 'abc'</span></pre></table></figure><p>这实际上可以把一个类的所有属性和方法调用全部动态化处理了，不需要任何特殊手段。<p>这种完全动态调用的特性有什么实际作用呢？作用就是，可以针对完全动态的情况作调用。<blockquote><p>比如服务器端的 REST API，调用 API 的 URL 类似：<ul><li><a href=http://api.server/user/friends rel=noopener target=_blank>http://api.server/user/friends</a><li><a href=http://api.server/user/timeline/list rel=noopener target=_blank>http://api.server/user/timeline/list</a></ul></blockquote><p>如果要写 SDK，给每个 URL 对应的 API 都写一个方法，那得累死，而且，API 一旦改动，SDK 也要改。<p>下面就可以完全动态的 <code>__getattr__</code> ，我们可以写出一个链式调用：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>_path <span class="token operator">=</span> path</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_path</pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>    __repr__ <span class="token operator">=</span> __str__</pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>status<span class="token punctuation">.</span>user<span class="token punctuation">.</span>timeline<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre><span class="token comment"># /status/user/timeline/list</span></pre></table></figure><blockquote><p>这段代码先是指定一个空的路径 <code>(path=''</code> 不传入参数)<p>调用 <code>status</code> 属性时，因为 <code>status</code> 不存在，方法 <code>__getattr__</code> 被触发， <code>status</code> 作为 <code>item</code> 传入，接着调用 <code>user</code> 属性，依次往后调用，直到<strong>最终调用</strong> <code>print(Chain().status.user.timeline.list)</code> 时， <code>__str__</code> 方法被调用，返回当前 <code>Chain</code> 实例的路径 <code>'/status/user/timeline/list'</code> ，并打印出来。</blockquote><p>这样就不用在路径更改的时候一个一个改了，它会自动修改并返回<p>这样，无论 API 怎么变，SDK 都可以根据 URL 实现完全动态的调用，而且，不随 API 的增加而改变！<p>还有些 REST API 会把<strong>参数</strong>放到 URL 中，比如 GitHub 的 API：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>GET <span class="token operator">/</span>users<span class="token operator">/</span><span class="token punctuation">:</span>user<span class="token operator">/</span>repos</pre></table></figure><p>调用时，需要把 <code>:user</code> 替换为实际用户名：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>_path <span class="token operator">=</span> path</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">global</span> name</pre><tr><td data-num=7><td><pre>        <span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token string">'name'</span><span class="token punctuation">:</span>  <span class="token comment"># 当属性为 name 时特殊处理</span></pre><tr><td data-num=8><td><pre>            <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>            <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=13><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_path</pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre>    __repr__ <span class="token operator">=</span> __str__</pre><tr><td data-num=16><td><pre></pre><tr><td data-num=17><td><pre></pre><tr><td data-num=18><td><pre>name <span class="token operator">=</span> <span class="token string">'micheal'</span></pre><tr><td data-num=19><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span>name<span class="token punctuation">.</span>repos<span class="token punctuation">)</span></pre><tr><td data-num=20><td><pre><span class="token comment"># /users/micheal/repos</span></pre></table></figure><blockquote><p>这里将传入的特定属性特殊化处理， <code>name</code> 全局变量可以改为 <code>input</code></blockquote><hr><blockquote><h4 id=__call__><a class=anchor href=#__call__>#</a> <code>__call__</code></h4></blockquote><p>当我们直接调用实例方法时，用的是 <code>instance.method()</code> 形式来进行调用，而如果我们直接在实例 (<em> <code>class + ()</code> 创建出来的一律算作实例</em>)<blockquote><p>下面这样对实例直接调用会报错</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>std <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># TypeError: 'Student' object is not callable</span></pre><tr><td data-num=9><td><pre><span class="token comment"># 不可调用对象</span></pre></table></figure><p>那如果我们要将其实现可调用 (<em>可以用这个方法重写上面的传入参数</em>)<p>只需要定义一个 <code>__call__()</code> 方法，就可以直接对实例进行调用:<pre><code>class Student(object):
    def __init__(self):
        self.name = 'Michael'

    def __call__(self):
        print('My name is %s.' % self.name)


std = Student()
std()
# My name is Michael.
</code></pre><blockquote><p>这样就可以将实例<strong>作为一种方法</strong>调用</blockquote><p><code>__call__()</code> 还<strong>可以定义参数</strong>，实例进行直接调用就好比对一个函数进行调用一样，所以你完全可以把对象看成函数，把函数看成对象<p>更多的时候，我们需要判断一个对象是否能被调用，能被调用的对象就是一个 <code>Callable</code> 对象，比如函数和我们上面定义的带有 <code>__call__()</code> 的类实例：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">callable</span><span class="token punctuation">(</span>Student<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># True</span></pre></table></figure><p>通过 <code>callable()</code> 函数，我们就可以判断一个对象是否是 “可调用” 对象。<blockquote><p><strong>对象</strong>可调用，即可以用 <code>()</code> 操作符进行调用</blockquote><hr><blockquote><p>用 <code>__call__</code> 改写上述链式调用含参问题:</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>_path <span class="token operator">=</span> path</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>        <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=12><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_path</pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre>    __repr__ <span class="token operator">=</span> __str__</pre><tr><td data-num=15><td><pre></pre><tr><td data-num=16><td><pre></pre><tr><td data-num=17><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>users<span class="token punctuation">(</span><span class="token string">'Micheal'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repos<span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># /users/Micheal/repos</span></pre></table></figure><p>先是调用了 <code>users</code> 方法，触发 <code>__getattr__</code> 然后返回对象，遇到 <code>('Micheal')</code> 后被<strong>组装为含参实例</strong>进行调用，接着再返回对象<h2 id=枚举类enum-class><a class=anchor href=#枚举类enum-class>#</a> 枚举类 (<em>Enum class</em>)</h2><p>当我们需要定义常量时，一个办法是用大写变量通过整数来定义，例如月份：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>JAN <span class="token operator">=</span> <span class="token number">1</span></pre><tr><td data-num=2><td><pre>FEB <span class="token operator">=</span> <span class="token number">2</span></pre><tr><td data-num=3><td><pre>MAR <span class="token operator">=</span> <span class="token number">3</span></pre><tr><td data-num=4><td><pre><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre><tr><td data-num=5><td><pre>NOV <span class="token operator">=</span> <span class="token number">11</span></pre><tr><td data-num=6><td><pre>DEC <span class="token operator">=</span> <span class="token number">12</span></pre></table></figure><p>好处是简单，缺点<strong>是类型是 <code>int</code> ，并且仍然是变量</strong><p>更好的方法是为这样的枚举类型定义一个<em> class</em> 类型，然后，每个常量都是<em> class</em> 的<strong>一个唯一实例</strong>。Python 提供了 ** <code>Enum</code> ** 类来实现这个功能：<blockquote><p>批量创建实例</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>Month <span class="token operator">=</span> Enum<span class="token punctuation">(</span><span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Mar'</span><span class="token punctuation">,</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span> <span class="token string">'Jun'</span><span class="token punctuation">,</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> <span class="token string">'Sep'</span><span class="token punctuation">,</span> <span class="token string">'Oct'</span><span class="token punctuation">,</span> <span class="token string">'Nov'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></table></figure><p>这样我们就获得了 ** <code>Month</code> 类型<strong>的</strong>枚举类 **，可以直接使用 ** <code>Month.Jan</code> ** 来引用一个常量，或者枚举它的所有成员：<blockquote><p>相当于 <code>Month</code> 这个类</blockquote><p>枚举类可以<strong>迭代</strong>，展示出所有<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>Month <span class="token operator">=</span> Enum<span class="token punctuation">(</span><span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Mar'</span><span class="token punctuation">,</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span> <span class="token string">'Jun'</span><span class="token punctuation">,</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> <span class="token string">'Sep'</span><span class="token punctuation">,</span> <span class="token string">'Oct'</span><span class="token punctuation">,</span> <span class="token string">'Nov'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token keyword">for</span> name<span class="token punctuation">,</span> member <span class="token keyword">in</span> Month<span class="token punctuation">.</span>__members__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'=>'</span><span class="token punctuation">,</span> member<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> member<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>    </pre><tr><td data-num=7><td><pre><span class="token comment"># Jan => Month.Jan , 1</span></pre><tr><td data-num=8><td><pre><span class="token comment"># Feb => Month.Feb , 2</span></pre><tr><td data-num=9><td><pre><span class="token comment"># Mar => Month.Mar , 3</span></pre><tr><td data-num=10><td><pre><span class="token comment"># Apr => Month.Apr , 4</span></pre><tr><td data-num=11><td><pre><span class="token comment"># May => Month.May , 5</span></pre><tr><td data-num=12><td><pre><span class="token comment"># Jun => Month.Jun , 6</span></pre><tr><td data-num=13><td><pre><span class="token comment"># Jul => Month.Jul , 7</span></pre><tr><td data-num=14><td><pre><span class="token comment"># Aug => Month.Aug , 8</span></pre><tr><td data-num=15><td><pre><span class="token comment"># Sep => Month.Sep , 9</span></pre><tr><td data-num=16><td><pre><span class="token comment"># Oct => Month.Oct , 10</span></pre><tr><td data-num=17><td><pre><span class="token comment"># Nov => Month.Nov , 11</span></pre><tr><td data-num=18><td><pre><span class="token comment"># Dec => Month.Dec , 12</span></pre></table></figure><p><code>value</code> 属性则是自动赋给成员的 <code>int</code> 常量，默认从 <code>1</code> 开始计数。<hr><p>如果需要更精确地控制枚举类型，可以从 <code>Enum</code> 派生出<strong>自定义</strong>类：<blockquote><p>更常用这个<p><code>Enum</code> 可以把一组相关常量定义在一个 class 中，且<strong><em> class</em> 不可变</strong>，而且成员可以直接比较</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum<span class="token punctuation">,</span> unique</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token decorator annotation punctuation">@unique</span></pre><tr><td data-num=5><td><pre><span class="token keyword">class</span> <span class="token class-name">Weekday</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    Sun <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># Value 可以自定义</span></pre><tr><td data-num=7><td><pre>    Mon <span class="token operator">=</span> <span class="token number">1</span></pre><tr><td data-num=8><td><pre>    Tue <span class="token operator">=</span> <span class="token number">2</span></pre><tr><td data-num=9><td><pre>    Wed <span class="token operator">=</span> <span class="token number">3</span></pre><tr><td data-num=10><td><pre>    Thu <span class="token operator">=</span> <span class="token number">4</span></pre><tr><td data-num=11><td><pre>    Fri <span class="token operator">=</span> <span class="token number">5</span></pre><tr><td data-num=12><td><pre>    Sat <span class="token operator">=</span> <span class="token number">6</span></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">)</span>  <span class="token comment"># 可以直接调用获取枚举成员</span></pre><tr><td data-num=16><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">[</span><span class="token string">'Tue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 还可以用 ['key'] 来获取</span></pre><tr><td data-num=17><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Wed<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment"># 获取 value</span></pre><tr><td data-num=18><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 通过 value 来获取枚举成员</span></pre><tr><td data-num=19><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment"># 多此一举</span></pre><tr><td data-num=20><td><pre><span class="token comment"># Weekday.Mon</span></pre><tr><td data-num=21><td><pre><span class="token comment"># Weekday.Tue</span></pre><tr><td data-num=22><td><pre><span class="token comment"># 3</span></pre><tr><td data-num=23><td><pre><span class="token comment"># Weekday.Thu</span></pre></table></figure><p>这里导入了 <code>unique</code> 进行修饰，为了确保 <code>Value</code> 没有<strong>重复值</strong><blockquote><p>此外，对于枚举成员，.name 和.value 是其内置属性，我们还可以给枚举成员增加其他属性:</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum<span class="token punctuation">,</span> unique</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token decorator annotation punctuation">@unique</span></pre><tr><td data-num=5><td><pre><span class="token keyword">class</span> <span class="token class-name">Weekday</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    Sun <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># Value 可以自定义</span></pre><tr><td data-num=7><td><pre>    Mon <span class="token operator">=</span> <span class="token number">1</span></pre><tr><td data-num=8><td><pre>    Tue <span class="token operator">=</span> <span class="token number">2</span></pre><tr><td data-num=9><td><pre>    Wed <span class="token operator">=</span> <span class="token number">3</span></pre><tr><td data-num=10><td><pre>    Thu <span class="token operator">=</span> <span class="token number">4</span></pre><tr><td data-num=11><td><pre>    Fri <span class="token operator">=</span> <span class="token number">5</span></pre><tr><td data-num=12><td><pre>    Sat <span class="token operator">=</span> <span class="token number">6</span></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre></pre><tr><td data-num=15><td><pre>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token string">'星期三'</span></pre><tr><td data-num=16><td><pre>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">.</span>work <span class="token operator">=</span> <span class="token string">'研学'</span></pre><tr><td data-num=17><td><pre>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token string">'10'</span></pre><tr><td data-num=18><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">.</span>label<span class="token punctuation">)</span></pre><tr><td data-num=19><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">.</span>work<span class="token punctuation">)</span></pre><tr><td data-num=20><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Mon<span class="token punctuation">.</span>time<span class="token punctuation">)</span></pre><tr><td data-num=21><td><pre><span class="token comment"># 星期三</span></pre><tr><td data-num=22><td><pre><span class="token comment"># 研学</span></pre><tr><td data-num=23><td><pre><span class="token comment"># 10</span></pre></table></figure><hr><p><strong>枚举类</strong>主要解决一般穷举无法解决的问题:<p>1、枚举的枚举项不能出现重复，即 key 不应该相同（以上例来讲，不能出现两个 Jan）<p>2、枚举项的值不应该允许在外部进行修改（枚举类型<strong>一般是固定下来的常量</strong>，声明好之后<strong>不能在外部随意更改</strong>）<blockquote><p>这时，如果我们在 Weekday 类中，声明重复的枚举成员，会产生错误：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># Error: Attempted to reuse key: 'wednesday'</span></pre></table></figure><p>如果在外部进行枚举成员属性值的修改，也会产生错误：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>Weekday<span class="token punctuation">.</span>Sun <span class="token operator">=</span> <span class="token number">7</span></pre><tr><td data-num=2><td><pre><span class="token comment"># AttributeError: cannot reassign member 'Sun'</span></pre></table></figure></blockquote><p><strong>如果要枚举类中的 Value 只能是整型数字，那么，可以导入 <code>IntEnum</code> ，然后继承 <code>IntEnum</code> 即可。注意，此时，如果 value 为字符串的数字，也不会报错。</strong><h2 id=元类><a class=anchor href=#元类>#</a> 元类</h2><blockquote><h5 id=重拾type><a class=anchor href=#重拾type>#</a> 重拾 <code>type()</code></h5></blockquote><blockquote><p>这里采用自创模块导入<p>创建了一个名为 <code>hello.py</code> 的模块，里面存放着 <code>Hello</code> 这个<em> class</em>：</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello %s!'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre></table></figure><p>然后在主函数中进行调用:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">from</span> hello <span class="token keyword">import</span> Hello</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre>h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token comment"># Hello world!</span></pre><tr><td data-num=8><td><pre><span class="token comment"># &LTclass 'type'></span></pre><tr><td data-num=9><td><pre><span class="token comment"># &LTclass 'hello.Hello'></span></pre><tr><td data-num=10><td><pre><span class="token comment">## 如果把 class 放在主函数内，上面就会是 & lt;class '__main__.Hello'> 表明在主函数内</span></pre></table></figure><blockquote><p>当 Python 解释器载入 <code>hello</code> 模块时，就会依次执行该模块的所有语句，执行结果就是动态创建出一个 <code>Hello</code> 的 class 对象。<p><code>type()</code> 函数可以查看一个类型或变量的类型， <code>Hello</code> 是一个<em> class</em>，它的类型就是 <code>type</code> ，而 <code>h</code> 是一个<strong>实例</strong>，它的类型就是 class <code>Hello</code> 。</blockquote><p>我们说<em> class</em> 的<strong>定义</strong>是运行时<strong>动态创建</strong>的，而创建<em> class</em> 的方法就是使用 <code>type()</code> 函数<p><code>type()</code> 函数<strong>既可以返回一个对象的类型，又可以创建出新的类型</strong>，比如，我们可以通过 <code>type()</code> 函数创建出 <code>Hello</code> 类，而无需通过 <code>class Hello(object)...</code> 的定义：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 这里必须加 self，不然后续不能通过。操作符访问</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello,%s.'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>Hello <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>hello<span class="token operator">=</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre>h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># Hello,world.</span></pre></table></figure><blockquote><p>像这样我们就可以不用 <code>class</code> 关键字创造一个类，而用 <code>type()</code> 即可</blockquote><p>要创建一个 class 对象， <code>type()</code> 函数依次传入 3 个参数：<ol><li>class 的<strong>名称</strong>；<li>继承的<strong>父类集合</strong> (格式为 <code>tuple</code> )，注意 Python 支持多重继承，如果只有一个父类，<strong>别忘了 <code>tuple</code> 的单元素写法</strong>；<li><em>class</em> 的<strong>方法名称与函数绑定</strong>，这里我们把函数 <code>fn</code> 绑定到方法名 <code>hello</code> 上。</ol><p>通过 <code>type()</code> 函数创建的类和直接写 class 是<strong>完全一样的</strong>，因为 Python 解释器遇到 class 定义时，仅仅是扫描一下 class 定义的语法，然后调用 <code>type()</code> 函数创建出 class『创建<em> class</em> 的本质』<blockquote><p>正常情况下，我们都用 <code>class Xxx...</code> 来定义类，但是， <code>type()</code> 函数也<strong>允许我们动态创建出类来</strong>，也就是说，<strong>动态语言本身支持运行期动态创建类</strong>，这和静态语言有非常大的不同，要在静态语言运行期创建类，必须构造源代码字符串再调用编译器，或者借助一些工具生成字节码实现，本质上都是动态编译，会非常复杂。</blockquote><blockquote><h3 id=metaclass><a class=anchor href=#metaclass>#</a> <code>metaclass</code></h3></blockquote><p>除了使用 <code>type()</code> 动态创建类以外，要控制类的创建行为，还可以使用 <code>metaclass</code><h1 id=错误调试与测试><a class=anchor href=#错误调试与测试>#</a> 错误调试与测试</h1><h2 id=错误处理><a class=anchor href=#错误处理>#</a> 错误处理</h2><p>在程序运行的过程中，如果发生了错误，可以事先约定返回一个错误代码，这样，就可以知道是否有错，以及出错的原因<p>但是用错误码来表示出错十分不方便，正确结果和错误码混在一起，导致判断不方便<p>一旦出错，还要一级一级上报，直到某个函数可以处理该错误<p>所以<strong>高级语言通常都内置</strong>了一套 <code>try...except...finally...</code> 的错误处理机制，Python 也不例外<hr><blockquote><h2 id=try><a class=anchor href=#try>#</a> try</h2></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying...'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> Result<span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> Result<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">finally</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally...'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token comment"># trying...</span></pre><tr><td data-num=11><td><pre><span class="token comment"># except: division by zero</span></pre><tr><td data-num=12><td><pre><span class="token comment"># finally...</span></pre><tr><td data-num=13><td><pre><span class="token comment"># END</span></pre></table></figure><blockquote><p>当我们认为某些代码可能会出错时，就可以用 <code>try</code> 来运行这段代码</blockquote><p>如果该段代码<strong>执行出错</strong>，则后续代码不会继续执行 (<em>例如这里的 <code>print('result:', r)</code> 语句</em>)，而是<strong>直接跳转至错误处理代码</strong>，即 <code>except</code> 语句块，执行完 <code>except</code> 后，如果有 <code>finally</code> 语句块，则执行 <code>finally</code> 语句块，至此，执行完毕。<blockquote><p>上面的代码在计算 <code>10 / 0</code> 时会产生一个除法运算错误『 <code>ZeroDivisionError</code> 』(<em>零除错误</em>)</blockquote><p>从上面输出也可以看出，后续的 <code>print('result:', r)</code> 不会被执行， <code>except</code> 因为捕获了 <code>ZeroDivisionError</code> ，然后被执行，最后再执行 <code>finally</code><blockquote><p>如果整段代码无报错，即不会执行 <code>except</code> 语句:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying...'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>   r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span></pre><tr><td data-num=4><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> Result<span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> Result<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">finally</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally...'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token comment"># trying...</span></pre><tr><td data-num=11><td><pre><span class="token comment"># result: 5.0</span></pre><tr><td data-num=12><td><pre><span class="token comment"># finally...</span></pre><tr><td data-num=13><td><pre><span class="token comment"># END</span></pre></table></figure><p>但是 <code>finally</code> 如果有，则一定会被执行（<em>可以没有 <code>finally</code> 语句</em>）<blockquote><p>没有错误发生，可以在 <code>except</code> 语句块<strong>后面加一个 <code>else</code> </strong>，当没有错误发生时，会自动执行 <code>else</code> 语句：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying...'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>   r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span></pre><tr><td data-num=4><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> Result<span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> Result<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No error'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token keyword">finally</span><span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally...'</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token comment"># trying...</span></pre><tr><td data-num=13><td><pre><span class="token comment"># result: 5.0</span></pre><tr><td data-num=14><td><pre><span class="token comment"># No error</span></pre><tr><td data-num=15><td><pre><span class="token comment"># finally...</span></pre><tr><td data-num=16><td><pre><span class="token comment"># END</span></pre></table></figure></blockquote></blockquote><hr><p>而错误应该有很多类型，如果发生了不同类型的错误，就应该由不同的 <code>except</code> 语句来捕获，没错，可以有多个 <code>except</code> 来捕获不同类型的错误（<em>但一个指定异常只能捕获一个或者一类异常</em>）：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying...'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">except</span> ValueError <span class="token keyword">as</span> value<span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> Result<span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> Result<span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre><span class="token keyword">finally</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally...'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre><span class="token comment"># trying...</span></pre><tr><td data-num=14><td><pre><span class="token comment"># except: invalid literal for int() with base 10: 'a'</span></pre><tr><td data-num=15><td><pre><span class="token comment"># finally...</span></pre><tr><td data-num=16><td><pre><span class="token comment"># END</span></pre></table></figure><blockquote><p>如果改成 0 就能被第二个所捕获</blockquote><p><code>int()</code> 函数可能会抛出 <code>ValueError</code> ，所以我们用一个 <code>except</code> 捕获 <code>ValueError</code> ，用另一个 <code>except</code> 捕获 <code>ZeroDivisionError</code> 。<hr><p>Python 的错误本质上也是<em> class</em>，所有的错误类型都<strong>继承自</strong> <code>BaseException</code><p>所以在使用 <code>except</code> 定向捕获错误时，要注意，它不但捕获该类型的错误，还具有捕获<strong>该类型错误的子类</strong>错误的作用:<blockquote><p>有些 IDE 将父类称为<strong>超类</strong></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    a <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'1997年，我学会了开汽车!'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre><span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ValueError'</span><span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">except</span> UnicodeError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'UnicodeError'</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token comment"># ValueError</span></pre></table></figure><p>第二个 <code>except</code> 永远也捕获不到 <code>UnicodeError</code> ，因为 <code>UnicodeError</code> 是 <code>ValueError</code> 的子类<p>这里是被第一个 <code>except</code> 给捕获了<blockquote><p>Python 所有的错误都是从 <code>BaseException</code> 类派生的，常见的错误类型和继承关系见官方文档:<a href=https://docs.python.org/3/library/exceptions.html#exception-hierarchy rel=noopener target=_blank>Built-in Exceptions — Python 3.12.1 documentation</a></blockquote><p>其中，还有种错误类型为<strong>万能异常 Exception</strong>，当不明确大概为什么错误类别时可以使用：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'try...'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error is '</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token comment"># try...</span></pre><tr><td data-num=8><td><pre><span class="token comment"># Error is  invalid literal for int() with base 10: 'a'</span></pre></table></figure><hr><p>当然我们也会想到，Python 也具有自定义异常的功能<p>通过创建一个新的<strong>异常类</strong>，我们可以命名自己的异常，可以通过直接或者间接的方式继承自 <code>Exception</code> 异常类或子类：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">NetworkError</span><span class="token punctuation">(</span>BaseException<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>        self<span class="token punctuation">.</span>msg <span class="token operator">=</span> msg</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>msg</pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>    <span class="token keyword">raise</span> NetworkError<span class="token punctuation">(</span><span class="token string">'类型错误'</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre>    <span class="token comment"># 人为创造错误</span></pre><tr><td data-num=12><td><pre><span class="token keyword">except</span> NetworkError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre><tr><td data-num=13><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre><tr><td data-num=14><td><pre><span class="token comment"># 类型错误</span></pre></table></figure><hr><p>此外，还可以跨越多层调用错误<p>这样在调用栈中会被 Python 解释器捕获<blockquote><h3 id=调用栈><a class=anchor href=#调用栈>#</a> 调用栈</h3></blockquote><p>如果错误没有被捕获，它就会一直往上抛，最后被 Python 解释器捕获，打印一个错误信息，然后<strong>程序退出</strong><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># Error.py</span></pre><tr><td data-num=2><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre><span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>    bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre></pre><tr><td data-num=14><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=16><td><pre><span class="token comment">#   File "Error.py", line 13, in &LTmodule></span></pre><tr><td data-num=17><td><pre><span class="token comment">#     main()</span></pre><tr><td data-num=18><td><pre><span class="token comment">#   File "Error.py", line 10, in main</span></pre><tr><td data-num=19><td><pre><span class="token comment">#     bar('0')</span></pre><tr><td data-num=20><td><pre><span class="token comment">#   File "Error.py", line 6, in bar</span></pre><tr><td data-num=21><td><pre><span class="token comment">#     return foo(s) * 2</span></pre><tr><td data-num=22><td><pre><span class="token comment">#            ^^^^^^</span></pre><tr><td data-num=23><td><pre><span class="token comment">#   File "Error.py", line 2, in foo</span></pre><tr><td data-num=24><td><pre><span class="token comment">#     return 10 / int(s)</span></pre><tr><td data-num=25><td><pre><span class="token comment">#            ~~~^~~~~~~~</span></pre><tr><td data-num=26><td><pre><span class="token comment"># ZeroDivisionError: division by zero</span></pre></table></figure><blockquote><p>就是运行时遇到 bug 时的常见情况</blockquote><p>现在解读错误信息：<p>第 1 行: <code>Traceback (most recent call last):</code> 告诉我们这是错误的追踪信息<p>第 2-3 行：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>File <span class="token string">"Error.py"</span><span class="token punctuation">,</span> line <span class="token number">13</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator"><</span>module<span class="token operator">></span></pre><tr><td data-num=2><td><pre>     main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></table></figure><p>表明调用 <code>main</code> 函数时出错，错误在代码文件 <code>Error.py</code> (<em>可能会有多个 <code>.py</code> 文件</em>) 的第十三行代码，但后面指出<strong>原因</strong>是在这个文件的第 9 行代码:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>File <span class="token string">"Error.py"</span><span class="token punctuation">,</span> line <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">in</span> main</pre><tr><td data-num=2><td><pre>     bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre></table></figure><p>调用 <code>bar</code> 函数出错了，在这个代码文件的第 10 行，但根据以下，原因是第 6 行：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>File <span class="token string">"Error.py"</span><span class="token punctuation">,</span> line <span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">in</span> bar</pre><tr><td data-num=2><td><pre>     <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span></pre><tr><td data-num=3><td><pre>            <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span></pre><tr><td data-num=4><td><pre><span class="token comment"># 这里着重强调了错误</span></pre></table></figure><p>这个 <code>return foo(s) * 2</code> 语句出错，但这还不是最终原因：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>File <span class="token string">"Error.py"</span><span class="token punctuation">,</span> line <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">in</span> foo</pre><tr><td data-num=2><td><pre>     <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>            <span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">^</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span></pre></table></figure><p>原因是 <code>return 10 / int(s)</code> 这个语句出错了，这是错误产生的源头，因为下面打印了：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>ZeroDivisionError<span class="token punctuation">:</span> division by zero</pre></table></figure><p>根据错误类型 <code>ZeroDivisionError</code> ，我们判断， <code>int(s)</code> 本身并没有出错，但是 <code>int(s)</code> 返回 <code>0</code> ，在计算 <code>10 / 0</code> 时出错，至此，找到错误源头。<p>➤<strong>注意</strong>：出错的时候，一定要分析错误的调用栈信息，才能定位错误的位置。(<em>把 IDE 的报错信息贴出来提问</em>)<blockquote><h3 id=记录错误><a class=anchor href=#记录错误>#</a> 记录错误</h3></blockquote><p>如果不捕获错误，自然可以让 Python 解释器来打印出错误堆栈，<strong>但程序也被结束了</strong>。既然我们能捕获错误，就可以把错误堆栈打印出来，然后分析错误原因，同时，让程序<strong>继续执行下去</strong>。<p>Python 内置的 <code>logging</code> 模块可以非常容易地记录错误日志：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> logging</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre><span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span></pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=13><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=14><td><pre>        bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>  <span class="token comment"># 这里使用了万能错误</span></pre><tr><td data-num=16><td><pre>        logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token comment"># 打印错误而不停止程序，使得可以执行 main 函数下方的语句</span></pre><tr><td data-num=17><td><pre></pre><tr><td data-num=18><td><pre></pre><tr><td data-num=19><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=20><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre><tr><td data-num=21><td><pre><span class="token comment"># ERROR:root:division by zero</span></pre><tr><td data-num=22><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=23><td><pre><span class="token comment">#   File "logging_error.py", line 14, in main</span></pre><tr><td data-num=24><td><pre><span class="token comment">#     bar('0')</span></pre><tr><td data-num=25><td><pre><span class="token comment">#   File "logging_error.py", line 9, in bar</span></pre><tr><td data-num=26><td><pre><span class="token comment">#     return foo(s) * 2</span></pre><tr><td data-num=27><td><pre><span class="token comment">#            ^^^^^^</span></pre><tr><td data-num=28><td><pre><span class="token comment">#   File "logging_error.py", line 5, in foo</span></pre><tr><td data-num=29><td><pre><span class="token comment">#     return 10 / int(s)</span></pre><tr><td data-num=30><td><pre><span class="token comment">#            ~~~^~~~~~~~</span></pre><tr><td data-num=31><td><pre><span class="token comment"># ZeroDivisionError: division by zero</span></pre><tr><td data-num=32><td><pre><span class="token comment"># END</span></pre></table></figure><p>同样是出错，但程序打印完错误信息后<strong>会继续执行</strong>，并正常退出<blockquote><p>通过配置， <code>logging</code> 还可以把错误记录到日志文件里，方便事后排查</blockquote><hr><blockquote><h3 id=抛出错误><a class=anchor href=#抛出错误>#</a> 抛出错误</h3></blockquote><blockquote><p>其实就是人为制造错误</blockquote><p>因为错误是 class，捕获一个错误就是捕获到该 class 的一个实例。因此，错误并不是凭空产生的，而是有意创建并抛出的。Python 的内置函数会抛出很多类型的错误，我们自己编写的函数也可以抛出错误<p>如果要抛出错误，首先根据需要，可以定义一个错误的 class，选择好继承关系，然后，用 <code>raise</code> 语句抛出一个错误的实例 (<em>正如之前的自定义错误一样</em>)：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">class</span> <span class="token class-name">FooError</span><span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token keyword">pass</span></pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">raise</span> FooError<span class="token punctuation">(</span><span class="token string">'Invalid value:%s'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n</pre><tr><td data-num=10><td><pre></pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre>foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=14><td><pre><span class="token comment">#   File "error.py", line 12, in &LTmodule></span></pre><tr><td data-num=15><td><pre><span class="token comment">#     foo('0')</span></pre><tr><td data-num=16><td><pre><span class="token comment">#   File "error.py", line 8, in foo</span></pre><tr><td data-num=17><td><pre><span class="token comment">#     raise FooError('Invalid value:%s' % s)</span></pre><tr><td data-num=18><td><pre><span class="token comment"># FooError: Invalid value:0</span></pre></table></figure><p>可以看出，执行到我们自己创建的错误时，直接抛出错误并结束程序，不会再往下进行<p>只有<strong>在必要的时候才定义我们自己的错误类型</strong>。如果可以选择 Python 已有的内置的错误类型（比如 <code>ValueError</code> ， <code>TypeError</code> ），<strong>尽量使用 Python 内置的错误类型</strong>。<p>最后，我们来看另一种错误处理的方式:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># err_reraise.py</span></pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'invalid value: %s'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n</pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre><span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=12><td><pre>        foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre><tr><td data-num=13><td><pre>    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre><tr><td data-num=14><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ValueError!: %s '</span> <span class="token operator">%</span> e<span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>        <span class="token keyword">raise</span></pre><tr><td data-num=16><td><pre></pre><tr><td data-num=17><td><pre></pre><tr><td data-num=18><td><pre>bar<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=19><td><pre></pre><tr><td data-num=20><td><pre><span class="token comment"># ValueError!: invalid value: 0 </span></pre><tr><td data-num=21><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=22><td><pre><span class="token comment">#   File "Error.py", line 18, in &LTmodule></span></pre><tr><td data-num=23><td><pre><span class="token comment">#     bar()</span></pre><tr><td data-num=24><td><pre><span class="token comment">#   File "Error.py", line 12, in bar</span></pre><tr><td data-num=25><td><pre><span class="token comment">#     foo('0')</span></pre><tr><td data-num=26><td><pre><span class="token comment">#   File "Error.py", line 6, in foo ## 引发错误的地点</span></pre><tr><td data-num=27><td><pre><span class="token comment">#     raise ValueError ('invalid value: % s' % s) ## 引发错误的原因</span></pre><tr><td data-num=28><td><pre><span class="token comment"># ValueError: invalid value: 0</span></pre></table></figure><blockquote><p>单个 <code>raise</code> 表示将当前错误原样抛出 (<em>执行完跳出 <code>except</code> 模块后继续执行下去</em>)</blockquote><p>在这里，我们已经捕获了错误并且给出了错误提示 ( <code>except</code> 后的语句，原因 <code>e</code> 也已打印出来)，但是为了精确定位<strong>追踪</strong>到该错误并且同时给出解决问题的方法<p>此外，在 <code>except</code> 中 <code>raise</code> 一个 Error，还可以把一种类型的错误转化成另一种类型：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span></pre><tr><td data-num=3><td><pre><span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'input error'</span><span class="token punctuation">)</span> <span class="token comment"># 带参数能自定义错误原因</span></pre><tr><td data-num=5><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=6><td><pre><span class="token comment">#   File "error.py", line 2, in &LTmodule></span></pre><tr><td data-num=7><td><pre><span class="token comment">#     10 / 0</span></pre><tr><td data-num=8><td><pre><span class="token comment">#     ~~~^~~</span></pre><tr><td data-num=9><td><pre><span class="token comment"># ZeroDivisionError: division by zero</span></pre><tr><td data-num=10><td><pre><span class="token comment"># </span></pre><tr><td data-num=11><td><pre><span class="token comment"># During handling of the above exception, another exception # occurred:</span></pre><tr><td data-num=12><td><pre><span class="token comment"># </span></pre><tr><td data-num=13><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=14><td><pre><span class="token comment">#   File "error.py", line 4, in &LTmodule></span></pre><tr><td data-num=15><td><pre><span class="token comment">#     raise ValueError('input error')</span></pre><tr><td data-num=16><td><pre><span class="token comment"># ValueError: input error</span></pre></table></figure><p>但是中间会有提示，一种错误的同时另一种发生了<blockquote><p>只要是合理的转换逻辑就可以，但是，决不应该把一个 <code>IOError</code> 转换成毫不相干的 <code>ValueError</code> 。</blockquote><h2 id=调试><a class=anchor href=#调试>#</a> 调试</h2><p>最简 (笨) 单 (比) 的调试方法就是用 <code>print()</code> 将所有的可能的有问题的变量数据全部打印出来<p>最麻烦的地方就是得一个一个删，运行结果也会包含很多垃圾信息<blockquote><h3 id=断言><a class=anchor href=#断言>#</a> 断言</h3></blockquote><p>凡是用 <code>print()</code> 来辅助查看的地方，都可以用断言（ <code>assert</code> ）来替代：<p><code>assert</code> 的意思是，表达式 <code>n != 0</code> 应该是 <code>True</code> ，否则，根据程序运行的逻辑，<strong>后面的代码肯定会出错</strong><p>如果断言失败， <code>assert</code> 语句本身就会抛出 <code>AssertionError</code> :<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre>    <span class="token keyword">assert</span> n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'n is zero!'</span></pre><tr><td data-num=4><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n</pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>    foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre>   </pre><tr><td data-num=9><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=11><td><pre><span class="token comment">#   File "error.py", line 10, in &LTmodule></span></pre><tr><td data-num=12><td><pre><span class="token comment">#     main()</span></pre><tr><td data-num=13><td><pre><span class="token comment">#   File "error.py", line 8, in main</span></pre><tr><td data-num=14><td><pre><span class="token comment">#     foo('0')</span></pre><tr><td data-num=15><td><pre><span class="token comment">#   File "error.py", line 3, in foo</span></pre><tr><td data-num=16><td><pre><span class="token comment">#     assert n != 0, 'n is zero!'</span></pre><tr><td data-num=17><td><pre><span class="token comment">#            ^^^^^^</span></pre><tr><td data-num=18><td><pre><span class="token comment"># AssertionError: n is zero!</span></pre></table></figure><blockquote><p>这里断言为 False，断言失败，抛出 <code>AssertionError</code></blockquote><p>程序中如果到处充斥着 <code>assert</code> ，和 <code>print()</code> 相比也好不到哪去。不过，<strong>启动 Python 解释器时</strong>可以用 <code>-O</code> 参数来关闭 <code>assert</code> 以显示正常错误结果：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>$ python <span class="token operator">-</span>O err<span class="token punctuation">.</span>py</pre><tr><td data-num=2><td><pre>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre><tr><td data-num=4><td><pre>ZeroDivisionError<span class="token punctuation">:</span> division by zero</pre></table></figure><blockquote><p>注意，是大写英文字母 O</blockquote><p>关闭后，你可以把所有的 <code>assert</code> 语句当成 <code>pass</code> 来看。<blockquote><h3 id=logging><a class=anchor href=#logging>#</a> <code>logging</code></h3></blockquote><p>把 <code>print()</code> 替换为 <code>logging</code> 是第 3 种方式，和 <code>assert</code> 比， <code>logging</code> 不会抛出错误，而且<strong>可以输出到文件</strong>：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> logging</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span> <span class="token comment"># 不加这个则正常报错，不会打印日志</span></pre><tr><td data-num=4><td><pre>s <span class="token operator">=</span> <span class="token string">'0'</span></pre><tr><td data-num=5><td><pre>n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'n = %d'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre>INFO<span class="token punctuation">:</span>root<span class="token punctuation">:</span>n <span class="token operator">=</span> <span class="token number">0</span></pre><tr><td data-num=9><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=10><td><pre><span class="token comment">#   File "error.py", line 7, in &LTmodule></span></pre><tr><td data-num=11><td><pre><span class="token comment">#     print(10 / n)</span></pre><tr><td data-num=12><td><pre><span class="token comment">#           ~~~^~~</span></pre><tr><td data-num=13><td><pre><span class="token comment"># ZeroDivisionError: division by zero</span></pre></table></figure><blockquote><p>必须指定打印信息的级别，有 <code>debug</code> ， <code>info</code> ， <code>warning</code> ， <code>error</code> 等几个级别</blockquote><p>当我们指定 <code>level=INFO</code> 时， <code>logging.debug</code> 就不起作用了。同理，指定 <code>level=WARNING</code> 后， <code>debug</code> 和 <code>info</code> 就不起作用了<p><code>logging</code> 的另一个好处是通过简单的配置，一条语句可以同时输出到不同的地方，比如 console 和文件。<blockquote><h3 id=pdb><a class=anchor href=#pdb>#</a> <code>pdb</code></h3></blockquote><blockquote><p>同下面的 <code>pdb.set_trace()</code> 都只是基本上是理论原理的教授，讲一讲概念，知道即可（没必要再造轮子）</blockquote><p>启动 Python 的调试器 <code>pdb</code> ，让程序以单步方式运行，可以随时查看运行状态。<p>先准备好代码文件：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># error.py</span></pre><tr><td data-num=2><td><pre>s <span class="token operator">=</span> <span class="token string">'0'</span></pre><tr><td data-num=3><td><pre>n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></pre></table></figure><p>然后启动：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>$ python <span class="token operator">-</span>m pdb error<span class="token punctuation">.</span>py</pre></table></figure><p>启动后， <code>pdb</code> 会定位到下一步要执行的代码 <code>-> s = '0'</code> 。输入命令 <code>l</code> 来查看代码：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> l</pre><tr><td data-num=2><td><pre>  <span class="token number">1</span>     <span class="token comment"># error.py</span></pre><tr><td data-num=3><td><pre>  <span class="token number">2</span>  <span class="token operator">-</span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token string">'0'</span></pre><tr><td data-num=4><td><pre>  <span class="token number">3</span>     n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre>  <span class="token number">4</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></pre></table></figure><p>输入命令 <code>n</code> 可以单步执行代码<p>任何时候都可以输入命令 <code>p 变量名</code> 来查看变量：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p s</pre><tr><td data-num=2><td><pre><span class="token string">'0'</span></pre><tr><td data-num=3><td><pre><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p n</pre><tr><td data-num=4><td><pre><span class="token number">0</span></pre></table></figure><p>输入命令 <code>q</code> 结束调试，退出程序<p>这种通过 <code>pdb</code> 在<strong>命令行</strong>调试的方法理论上是万能的，但实在是太麻烦了<p>如果代码数量过多我们得一步一步向下递进，麻烦<blockquote><h3 id=pdbset_trace><a class=anchor href=#pdbset_trace>#</a> <code>pdb.set_trace()</code></h3></blockquote><p>这个方法也是用 <code>pdb</code> ，但是不需要单步执行，我们只需要 <code>import pdb</code> ，然后，在可能出错的地方放一个 <code>pdb.set_trace()</code> ，就可以<strong>设置一个断点</strong>：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># error.py</span></pre><tr><td data-num=2><td><pre><span class="token keyword">import</span> pdb</pre><tr><td data-num=3><td><pre></pre><tr><td data-num=4><td><pre>s <span class="token operator">=</span> <span class="token string">'0'</span></pre><tr><td data-num=5><td><pre>n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>pdb<span class="token punctuation">.</span>set_trace<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># pdb 运行到这里会自动暂停</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></pre></table></figure><p>运行代码，程序会自动在 <code>pdb.set_trace()</code> 暂停并进入 pdb 调试环境，可以用命令 <code>p</code> 查看变量，或者用命令 <code>c</code> 继续运行：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p n</pre><tr><td data-num=3><td><pre><span class="token number">0</span></pre><tr><td data-num=4><td><pre><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> c</pre><tr><td data-num=5><td><pre><span class="token comment"># Traceback (most recent call last):</span></pre><tr><td data-num=6><td><pre><span class="token comment">#   File "err.py", line 7, in &LTmodule></span></pre><tr><td data-num=7><td><pre><span class="token comment">#     print(10 / n)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># ZeroDivisionError: division by zero</span></pre></table></figure><p>这个方式比直接启动 <code>pdb</code> 单步调试效率要高很多，但也高不到哪去<blockquote><h3 id=ide><a class=anchor href=#ide>#</a> IDE</h3></blockquote><p>究极大杀器，目前基于 <code>Pycharm</code> 进行调试，可以更加便携地设置断点以及查看变量<blockquote><p>虽然用 IDE 调试起来比较方便，但是最后你会发现，logging 才是终极武器</blockquote><h2 id=单元测试><a class=anchor href=#单元测试>#</a> 单元测试</h2><p>单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。<blockquote><p>比如我们编写的<strong>类似</strong> <code>abs()</code> 的函数，我们可以编写出以下几个测试用例：<ol><li>输入正数，比如 <code>1</code> 、 <code>1.2</code> 、 <code>0.99</code> ，期待返回值与输入相同；<li>输入负数，比如 <code>-1</code> 、 <code>-1.2</code> 、 <code>-0.99</code> ，期待返回值与输入相反；<li>输入 <code>0</code> ，期待返回 <code>0</code> ；<li>输入非数值类型，比如 <code>None</code> 、 <code>[]</code> 、 <code>{}</code> ，期待抛出 <code>TypeError</code> 。</ol></blockquote><p>把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。<p>如果所有单元测试通过，说明我们测试的这个函数能够正常工作，但凡有一个不能通过，要么函数有 bug，要么测试条件输入不正确，需要进行修复<p>单元测试通过后有什么意义呢？如果我们对 <code>abs()</code> 函数代码做了修改，只需要再跑一遍单元测试，如果通过，说明我们的修改不会对 <code>abs()</code> 函数原有的行为造成影响，如果测试不通过，说明我们的修改与原有行为不一致，要么修改代码，要么修改测试。<blockquote><p>这种以测试为驱动的开发模式<strong>最大的好处</strong>就是确保一个程序模块的行为符合我们设计的测试用例。在将来修改的时候，可以极大程度地保证该模块行为仍然是正确的。</blockquote><hr><p>例如下面对编写的 <code>Dict()</code> <strong> 类</strong>进行测试（要让这个类实现和基本的 <code>Dict</code> 字典方法一致）, 先编写一个外置的 <code>mydict</code> 模块 (<em>模块化编程</em>)：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># mydict</span></pre><tr><td data-num=2><td><pre><span class="token keyword">class</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=4><td><pre>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token comment"># 这里用这个调用父类的 init 方法</span></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>            <span class="token keyword">return</span> self<span class="token punctuation">[</span>item<span class="token punctuation">]</span></pre><tr><td data-num=9><td><pre>        <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>            <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">r"'Dict' object has no attribute '%s'"</span> <span class="token operator">%</span> item<span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre></pre><tr><td data-num=12><td><pre>    <span class="token keyword">def</span> <span class="token function">__setattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 设置键 - 值 key-value</span></pre><tr><td data-num=13><td><pre>        self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value			<span class="token comment"># 如果不存在会自动创建</span></pre></table></figure><blockquote><p><code>__getattr__</code> 获取不到 <code>key</code> 直接报错</blockquote><p>下面是<strong>单元测试模块</strong>:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> unittest</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">from</span> mydict <span class="token keyword">import</span> Dict</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre><span class="token keyword">class</span> <span class="token class-name">TestDict</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">test_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span></pre><tr><td data-num=11><td><pre>        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 为真的话抛出 True</span></pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre>    <span class="token keyword">def</span> <span class="token function">test_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=14><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>        d<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'value'</span></pre><tr><td data-num=16><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre></pre><tr><td data-num=18><td><pre>    <span class="token keyword">def</span> <span class="token function">test_attr</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=19><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=20><td><pre>        d<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token string">'value'</span></pre><tr><td data-num=21><td><pre>        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token string">'key'</span> <span class="token keyword">in</span> d<span class="token punctuation">)</span></pre><tr><td data-num=22><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span></pre><tr><td data-num=23><td><pre></pre><tr><td data-num=24><td><pre>    <span class="token keyword">def</span> <span class="token function">test_keyerror</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=25><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=26><td><pre>        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=27><td><pre>            value <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">'empty'</span><span class="token punctuation">]</span></pre><tr><td data-num=28><td><pre></pre><tr><td data-num=29><td><pre>    <span class="token keyword">def</span> <span class="token function">test_attrerror</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=30><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=31><td><pre>        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>AttributeError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=32><td><pre>            value <span class="token operator">=</span> d<span class="token punctuation">.</span>empty</pre><tr><td data-num=33><td><pre></pre><tr><td data-num=34><td><pre></pre><tr><td data-num=35><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre><tr><td data-num=36><td><pre>    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></table></figure><p>编写单元测试的时候我们需要编写一个从 <code>unittest.TestCase</code> 继承的<strong>测试类</strong><blockquote><p><code>unittest.main()</code> 是用于<strong>执行测试的一种方式</strong>，它会<strong>自动找到测试类</strong>并执行其中的测试方法『以 <code>test</code> 开头的方法就是测试方法，不以其开头的不被认为是执行方法，测试的时候不会被执行』</blockquote><p><strong>对每一类测试都需要编写</strong>一个 <code>test_xxx()</code> 方法。由于 <code>unittest.TestCase</code> 提供了很多<strong>内置的条件判断</strong> (<em>断言类</em>)，我们只需要调用这些方法就可以<strong>断言输出是否是我们所期望的</strong>。最常用的断言就是 <code>assertEqual()</code> ：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre>self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># 相等为 True 不等抛出断言错误</span></pre></table></figure><p>另一种重要的断言就是期待抛出指定类型的 Error，比如通过 <code>d['empty']</code> 访问<strong>不存在</strong>的 key 时，断言会抛出 <code>KeyError</code><blockquote><p>测试输入不存在的 <code>key</code> 时，会不会报错:</blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 这段语句期待下面的表达式产生 keyError，若产生则测试通过，不产生则测试失败</span></pre><tr><td data-num=2><td><pre>    value <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">'empty'</span><span class="token punctuation">]</span></pre></table></figure><p>这里则期待抛出<strong>属性</strong>错误 (<em> <code>AttrbuteError</code> </em>):<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>AttributeError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=2><td><pre>    value <span class="token operator">=</span> d<span class="token punctuation">.</span>empty</pre></table></figure><blockquote><p>其中，这些语句中的 <code>with</code> 关键字起到了上下文管理器的作用<p>上下文管理器是一个实现 <code>__enter__</code> 和 <code>__exit__</code> 方法的类，使用 <code>with</code> 语句<strong>确保</strong>在嵌套块的末尾调用 <code>__exit__</code> 方法</blockquote><hr><blockquote><h3 id=setup与teardown><a class=anchor href=#setup与teardown>#</a> <code>setUp</code> 与 <code>tearDown</code></h3></blockquote><p>可以在<strong>单元测试</strong>中编写两个特殊的 <code>setUp()</code> 和 <code>tearDown()</code> 方法。这两个方法会分别在<strong>每调用一个测试方法的前后分别被执行</strong>：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> unittest</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">from</span> mydict <span class="token keyword">import</span> Dict</pre><tr><td data-num=4><td><pre></pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre><span class="token keyword">class</span> <span class="token class-name">TestDict</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=7><td><pre>    <span class="token keyword">def</span> <span class="token function">setUp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'setUp...'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre></pre><tr><td data-num=10><td><pre>    <span class="token keyword">def</span> <span class="token function">tearDown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tearDown...'</span><span class="token punctuation">)</span></pre><tr><td data-num=12><td><pre></pre><tr><td data-num=13><td><pre>    <span class="token keyword">def</span> <span class="token function">test_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=14><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre><tr><td data-num=16><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span></pre><tr><td data-num=17><td><pre>        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=18><td><pre></pre><tr><td data-num=19><td><pre>    <span class="token keyword">def</span> <span class="token function">test_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=20><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=21><td><pre>        d<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'value'</span></pre><tr><td data-num=22><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span></pre><tr><td data-num=23><td><pre></pre><tr><td data-num=24><td><pre>    <span class="token keyword">def</span> <span class="token function">test_attr</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=25><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=26><td><pre>        d<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token string">'value'</span></pre><tr><td data-num=27><td><pre>        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token string">'key'</span> <span class="token keyword">in</span> d<span class="token punctuation">)</span></pre><tr><td data-num=28><td><pre>        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span></pre><tr><td data-num=29><td><pre></pre><tr><td data-num=30><td><pre>    <span class="token keyword">def</span> <span class="token function">test_keyerror</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=31><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=32><td><pre>        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=33><td><pre>            value <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">'empty'</span><span class="token punctuation">]</span></pre><tr><td data-num=34><td><pre></pre><tr><td data-num=35><td><pre>    <span class="token keyword">def</span> <span class="token function">test_attrerror</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=36><td><pre>        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=37><td><pre>        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>AttributeError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=38><td><pre>            value <span class="token operator">=</span> d<span class="token punctuation">.</span>empty</pre><tr><td data-num=39><td><pre></pre><tr><td data-num=40><td><pre></pre><tr><td data-num=41><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre><tr><td data-num=42><td><pre>    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=43><td><pre></pre><tr><td data-num=44><td><pre><span class="token comment"># setUp...</span></pre><tr><td data-num=45><td><pre><span class="token comment"># tearDown...</span></pre><tr><td data-num=46><td><pre><span class="token comment"># setUp...</span></pre><tr><td data-num=47><td><pre><span class="token comment"># tearDown...</span></pre><tr><td data-num=48><td><pre><span class="token comment"># setUp...</span></pre><tr><td data-num=49><td><pre><span class="token comment"># tearDown...</span></pre><tr><td data-num=50><td><pre><span class="token comment"># setUp...</span></pre><tr><td data-num=51><td><pre><span class="token comment"># tearDown...</span></pre><tr><td data-num=52><td><pre><span class="token comment"># setUp...</span></pre><tr><td data-num=53><td><pre><span class="token comment"># tearDown...</span></pre><tr><td data-num=54><td><pre><span class="token comment"># </span></pre><tr><td data-num=55><td><pre><span class="token comment"># </span></pre><tr><td data-num=56><td><pre><span class="token comment"># Ran 5 tests in 0.002s</span></pre><tr><td data-num=57><td><pre><span class="token comment"># </span></pre><tr><td data-num=58><td><pre><span class="token comment"># OK</span></pre></table></figure><blockquote><p><code>setUp()</code> 和 <code>tearDown()</code> 方法有什么用呢？设想你的<strong>测试需要启动一个数据库</strong>，这时，就可以在 <code>setUp()</code> 方法中连接数据库，在 <code>tearDown()</code> 方法中关闭数据库，这样，不必在每个测试方法中<strong>重复相同的代码</strong></blockquote><hr><p>单元测试的测试用例要覆盖常用的输入组合、边界条件和异常。<p>单元测试代码要<strong>非常简单</strong>，如果测试代码太复杂，那么测试代码本身就可能有 bug。<p>单元测试通过了<strong>并不意味着程序就没有 bug 了</strong>，但是不通过程序肯定有 bug。<h2 id=文档测试><a class=anchor href=#文档测试>#</a> 文档测试</h2><p>在 Python 官方文档中很多文档都有示例代码<p>这些示例代码只能够在 python 的交互式环境下输入并且执行，结果与其文档中一致<p>而我们就可以使其自动在注释中运行并且<strong>指定我们想要输出的结果</strong>:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">def</span> <span class="token function">abs</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 告诉了函数的调用者该函数的期望输入和输出</span></pre><tr><td data-num=2><td><pre>    <span class="token triple-quoted-string string">'''</span></pre><tr><td data-num=3><td><pre>    Function to get absolute value of number.</pre><tr><td data-num=4><td><pre>    </pre><tr><td data-num=5><td><pre>    Example:</pre><tr><td data-num=6><td><pre>    </pre><tr><td data-num=7><td><pre>    >>> abs(1)</pre><tr><td data-num=8><td><pre>    1</pre><tr><td data-num=9><td><pre>    >>> abs(-1)</pre><tr><td data-num=10><td><pre>    1</pre><tr><td data-num=11><td><pre>    >>> abs(0)</pre><tr><td data-num=12><td><pre>    0</pre><tr><td data-num=13><td><pre>    '''</pre><tr><td data-num=14><td><pre>    <span class="token keyword">return</span> n <span class="token keyword">if</span> n <span class="token operator">>=</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token operator">-</span>n<span class="token punctuation">)</span></pre><tr><td data-num=15><td><pre>    </pre><tr><td data-num=16><td><pre><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span> <span class="token comment"># 加入这段代码即可测试，全通过不显示，不通过报错</span></pre><tr><td data-num=17><td><pre>    <span class="token keyword">import</span> doctest</pre><tr><td data-num=18><td><pre>    doctest<span class="token punctuation">.</span>testmod<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></table></figure><p>Python 内置的 “文档测试”（ <code>doctest</code> ）模块可以直接提取注释中的代码并执行测试<p><code>doctest</code> 严格按照 Python<strong> 交互式命令行</strong>的输入和输出来判断测试结果是否正确。只有<strong>测试异常</strong>的时候，可以用 <code>...</code> 表示中间一大段烦人的输出。<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># 用文档测试上节的 Dict 类</span></pre><tr><td data-num=2><td><pre><span class="token keyword">class</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=3><td><pre>    <span class="token triple-quoted-string string">'''</span></pre><tr><td data-num=4><td><pre>    Simple dict but also support access as x.y style.</pre><tr><td data-num=5><td><pre></pre><tr><td data-num=6><td><pre>    >>> d1 = Dict()</pre><tr><td data-num=7><td><pre>    >>> d1['x'] = 100</pre><tr><td data-num=8><td><pre>    >>> d1.x</pre><tr><td data-num=9><td><pre>    100</pre><tr><td data-num=10><td><pre>    >>> d1.y = 200</pre><tr><td data-num=11><td><pre>    >>> d1['y']</pre><tr><td data-num=12><td><pre>    200</pre><tr><td data-num=13><td><pre>    >>> d2 = Dict(a=1, b=2, c='3')</pre><tr><td data-num=14><td><pre>    >>> d2.c</pre><tr><td data-num=15><td><pre>    '3'</pre><tr><td data-num=16><td><pre>    >>> d2['empty']</pre><tr><td data-num=17><td><pre>    Traceback (most recent call last):</pre><tr><td data-num=18><td><pre>        ...</pre><tr><td data-num=19><td><pre>    KeyError: 'empty'</pre><tr><td data-num=20><td><pre>    >>> d2.empty</pre><tr><td data-num=21><td><pre>    Traceback (most recent call last):</pre><tr><td data-num=22><td><pre>        ...</pre><tr><td data-num=23><td><pre>    AttributeError: 'Dict' object has no attribute 'empty'</pre><tr><td data-num=24><td><pre>    '''</pre><tr><td data-num=25><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=26><td><pre>        <span class="token builtin">super</span><span class="token punctuation">(</span>Dict<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kw<span class="token punctuation">)</span></pre><tr><td data-num=27><td><pre></pre><tr><td data-num=28><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=29><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre><tr><td data-num=30><td><pre>            <span class="token keyword">return</span> self<span class="token punctuation">[</span>key<span class="token punctuation">]</span></pre><tr><td data-num=31><td><pre>        <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span></pre><tr><td data-num=32><td><pre>            <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">r"'Dict' object has no attribute '%s'"</span> <span class="token operator">%</span> key<span class="token punctuation">)</span></pre><tr><td data-num=33><td><pre></pre><tr><td data-num=34><td><pre>    <span class="token keyword">def</span> <span class="token function">__setattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=35><td><pre>        self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value</pre><tr><td data-num=36><td><pre></pre><tr><td data-num=37><td><pre><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span></pre><tr><td data-num=38><td><pre>    <span class="token keyword">import</span> doctest</pre><tr><td data-num=39><td><pre>    doctest<span class="token punctuation">.</span>testmod<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></table></figure><blockquote><p>测试异常时中间的文件信息可以省略，用 <code>...</code> 代替<p>模块正常被导入时 <code>doctest</code> 不会被执行，要加入 <code>test</code> 条件</blockquote><p>要想正常测试时也输出详细信息，则可以把最后一行改为： <code>doctest.testmod(verbose=True)</code> ，默认是 <code>False</code><h1 id=正则表达式><a class=anchor href=#正则表达式>#</a> 正则表达式</h1><p>正则表达式是一种用来匹配字符串的强有力的武器。它的设计思想是用一种描述性的语言来给字符串定义一个规则，凡是符合规则的字符串，我们就认为它 “匹配” 了，否则，该字符串就是不合法的。<blockquote><p>比如判断一个字符串是否是合法的 Email 地址格式，若是一个一个提取则非常麻烦且代码难以复用</blockquote><p>所以我们判断一个字符串是否是合法的 Email 的方法是：<ol><li>创建一个<strong>匹配 Email 的正则表达式</strong>；<li>用该正则表达式去<strong>匹配用户的输入</strong>来判断是否合法。</ol><p>因为正则表达式也是用字符串表示的，所以，我们要首先了解如何用字符来描述字符<p>在正则表达式中，如果直接给出字符，就是<strong>精确匹配</strong><p>如果加入 <code>\</code> 反转义则可以匹配多个：用 <code>\d</code> 可以匹配一个数字， <code>\w</code> 可以匹配一个字母或数字<blockquote><p>比如:<ul><li><code>'00\d'</code> 可以匹配 <code>'007'</code> ，但无法匹配 <code>'00A'</code> ；<li><code>'\d\d\d'</code> 可以匹配 <code>'010'</code> ；<li><code>'\w\w\d'</code> 可以匹配 <code>'py3'</code> ；</ul><p><code>.</code> 可以匹配任意字符串，所以： <code>'py.'</code> 可以匹配任意 <code>'pyc'</code> 等</blockquote><p>要匹配<strong>变长的字符</strong> (<em>一下子匹配多个字符</em>)，在正则表达式中，用 <code>*</code> 表示任意个字符（包括 0 个），用 ** <code>+</code> <strong> 表示至少一个字符，用</strong> <code>?</code> <strong> 表示 0 个或 1 个字符，用</strong> <code>{n}</code> <strong> 表示 n 个字符，用</strong> <code>{n,m}</code> ** 表示 n-m 个字符<p>比如这个例子 <code>\d{3}\s+\d{3,8}</code><p>从左往右读：<ol><li><code>\d{3}</code> 表示匹配 3 个数字，如： <code>'010'</code><li><code>\s</code> 表示匹配<strong>一个空格或者一个制表符</strong> (<em>Tab 键</em>)<strong> 或者一个换行符</strong> ( <code>\n</code> )，所以 <code>\s+</code> 表示<strong>至少匹配一个空格</strong><li><code>\d{3,8}</code> 则表示匹配 3-8 个数字，例: <code>'1234567'</code></ol><p>综合起来，上面的正则表达式可以匹配以<strong>任意个空格隔开</strong>的带区号的电话号码<blockquote><p>因为贪婪匹配，匹配到第一个后面加空格过了 ** <code>\s+</code> ** 后面就不匹配了</blockquote><blockquote><h3 id=进阶><a class=anchor href=#进阶>#</a> 进阶</h3></blockquote><p>要做更精确匹配，可以用 <code>[]</code> 来表示范围，例：<ul><li><code>[0-9a-zA-Z\_]</code> 可以匹配<strong>一个</strong>数字、字母或者下划线；</ul><blockquote><p><code>_</code> 加斜杠反转义，优先匹配第一个最符合的字符</blockquote><ul><li><code>[0-9a-zA-Z\_]+</code> 可以匹配<strong>至少一个</strong>数字、字母或者下划线<strong>或者及其组成的字符串</strong>，例如： <code>'a100'</code> , <code>py3000</code> ， <code>'1'</code> 等<li><code>[a-zA-Z\_][0-9a-zA-Z\_]*</code> 可以匹配由<strong>字母或下划线开头</strong>，后接<strong>任意个</strong>由一个数字、字母或者下划线或及其组成的字符串，也就是 Python 合法的变量；<li><code>[a-zA-Z\_][0-9a-zA-Z\_]{0, 19}</code> 更精确地限制了变量的长度是 1-20 个字符（<em> <code>{}</code> 限定后面的字符</em>：前面 1 个字符 + 后面最多 19 个字符）<li><code>(A|B)</code> 可以匹配 A 或 B<li>** <code>^</code> ** 表示行的开头，所以 <code>^\d</code> 表示必须以数字开头<li><code>$</code> 表示行的结束，所以 ** <code>\d$</code> ** 表示必须以数字结束</ul><blockquote><p>所以例如 <code>^Py$</code> 匹配整行只能匹配 <code>Py</code></blockquote><blockquote><h3 id=re模块><a class=anchor href=#re模块>#</a> re 模块</h3></blockquote><p>有了准备知识，我们就可以在 Python 中使用正则表达式了<p>Python 提供 <code>re</code> 模块，包含所有正则表达式的功能。由于 Python 的字符串本身也用 <code>\</code> 转义，所以要特别注意：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># 例如单用反斜杠表示路径</span></pre><tr><td data-num=2><td><pre>s <span class="token operator">=</span> <span class="token string">'ABC\\-001'</span></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># ABC\-001</span></pre></table></figure><p>因此我们强烈建议使用 Python 的 <code>r</code> 前缀，就<strong>不用考虑转义</strong>的问题了：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token comment"># 例如单用反斜杠表示路径</span></pre><tr><td data-num=2><td><pre>s <span class="token operator">=</span> <span class="token string">r'ABC\-001'</span></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># ABC\-001</span></pre></table></figure><hr><p>利用 <code>re</code> 模块将正则表达式匹配字符串：<p>利用 <code>re</code> 模块自带的 <code>match()</code> 方法判断是否匹配成功<blockquote><p>成功则返回一个 Match 对象可以进行判断匹配了哪部分，否则返回 <code>None</code></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>pattern <span class="token operator">=</span> <span class="token string">r'^Py$'</span></pre><tr><td data-num=4><td><pre>test <span class="token operator">=</span> <span class="token string">'Py'</span></pre><tr><td data-num=5><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token comment"># &LTre.Match object; span=(0, 2), match='Py'></span></pre><tr><td data-num=7><td><pre><span class="token comment">## 表示和 Py 匹配上了</span></pre></table></figure><p>还有更规范写法：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>pattern <span class="token operator">=</span> <span class="token string">r'^Py$'</span></pre><tr><td data-num=4><td><pre>test <span class="token operator">=</span> <span class="token string">'Py'</span></pre><tr><td data-num=5><td><pre><span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=6><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre><tr><td data-num=8><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'failed'</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token comment"># OK</span></pre></table></figure><blockquote><p><strong>debug</strong> 的时候可以用第一种直接把匹配了的打印出来</blockquote><blockquote><h3 id=切分字符串><a class=anchor href=#切分字符串>#</a> 切分字符串</h3></blockquote><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a b   c'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=2><td><pre><span class="token comment"># ['a', 'b', '', '', 'c']</span></pre></table></figure><blockquote><p>这种只能够识别单个空格进行切分 (或者把 <code>' '</code> 删掉也行)</blockquote><p>来用正则切分：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'\s+'</span><span class="token punctuation">,</span> <span class="token string">'a b  c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># ['a', 'b', 'c']</span></pre></table></figure><blockquote><p>按至少匹配一个空格进行切分</blockquote><p>加入 <code>,</code> 试试:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[\s,]+'</span><span class="token punctuation">,</span> <span class="token string">'a,b, c  d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># ['a', 'b', 'c', 'd']</span></pre></table></figure><blockquote><p>表示按前面的正则表达式模式去切分字符串，** <code>[\s,]</code> ** 表示匹配任意空格字符 <code>\s</code> <strong> 或者</strong>逗号</blockquote><p>再加入 <code>;</code> 试试：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[\s,;]+'</span><span class="token punctuation">,</span> <span class="token string">'a,b;; c  d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=4><td><pre><span class="token comment"># ['a', 'b', 'c', 'd']</span></pre></table></figure><p>所以正则表达式可以用来<strong>处理</strong>用户不规范的输入<blockquote><h3 id=分组><a class=anchor href=#分组>#</a> 分组</h3></blockquote><p>除了简单地判断是否匹配之外，正则表达式还有<strong>提取子串</strong>的强大功能<p>可以以 ** <code>()</code> ** 来表示要提取的分组 (<em>Group</em>)<blockquote><p>不在 <code>()</code> 之内的无法用 <code>group</code> 提取出</blockquote><p>r 如 <code>^(\d{3})-(\d{3,8})$</code> 分别定义了<strong>两个组</strong>，可以直接从匹配的字符串中提取出区号和本地号码：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>pattern <span class="token operator">=</span> <span class="token string">r'^(\d{3})-(\d{3,8})$'</span></pre><tr><td data-num=4><td><pre>string <span class="token operator">=</span> <span class="token string">'010-12345'</span></pre><tr><td data-num=5><td><pre>m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre></pre><tr><td data-num=9><td><pre><span class="token comment"># &LTre.Match object; span=(0, 9), match='010-12345'></span></pre><tr><td data-num=10><td><pre><span class="token comment"># 010-12345 010 12345</span></pre></table></figure><p>如果正则表达式中定义了组，就可以在 <code>Match</code> 对象上用 <code>group()</code> 方法提取出子串来。<p>注意到 <code>group(0)</code> 永远是与整个正则表达式相匹配的字符串， <code>group(1)</code> 、 <code>group(2)</code> …… 表示第 1、2、…… 个子串。<p>提取字串不仅可以用于提取电话区号和号码 (<em>两数之和</em>)，比如提取日期：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>time <span class="token operator">=</span> <span class="token string">'15:35:30'</span></pre><tr><td data-num=4><td><pre>pattern <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">r'^(0[0-9]|1[0-9]|2[0-3]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\:(0[0-9]|1[0-9]|2['</span></pre><tr><td data-num=5><td><pre>           <span class="token string">r'0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])$'</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre>		<span class="token comment"># 这里解释器自动分为了两段合起来，不影响↑</span></pre><tr><td data-num=7><td><pre>m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> time<span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=9><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=10><td><pre><span class="token comment"># &LTre.Match object; span=(0, 8), match='15:35:30'></span></pre><tr><td data-num=11><td><pre><span class="token comment"># 15:35:30 15 35 30</span></pre></table></figure><blockquote><p>点数为 <code>0，1，2</code> 时分 <code>0，1，2，3，4，5</code></blockquote><p>这个正则表达式可以直接识别合法的时间。<p>比如识别日期可以将模式串改为：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token string">'^(0[1-9]|1[0-2]|[0-9])-(0[1-9]|1[0-9]|2[0-9]|3[0-1]|[0-9])$'</span></pre></table></figure><p>对于 <code>'2-30'</code> ， <code>'4-31'</code> 这样的非法日期，就必须配合逻辑判断了<blockquote><h3 id=贪婪匹配><a class=anchor href=#贪婪匹配>#</a> 贪婪匹配</h3></blockquote><p>最后需要特别指出的是，正则匹配<strong>默认是</strong>贪婪匹配，也就是<strong>匹配尽可能多的字符</strong>。(前面也见到了)<p>例如:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>string <span class="token operator">=</span> <span class="token string">'102300'</span></pre><tr><td data-num=4><td><pre>pattern <span class="token operator">=</span> <span class="token string">r'^(\d+)(0*)$'</span></pre><tr><td data-num=5><td><pre>m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># groups 输出所有组</span></pre><tr><td data-num=8><td><pre><span class="token comment"># &LTre.Match object; span=(0, 6), match='102300'></span></pre><tr><td data-num=9><td><pre><span class="token comment"># ('102300', '')</span></pre></table></figure><blockquote><p>注意，使用 ** <code>groups</code> ** 后面没必要带参数， <code>re.groups()</code> 方法并不接受任何参数</blockquote><p>由于这里的 <code>\d+</code> 采用的是贪婪匹配，会尽量匹配最大数量的数字，直接把后面的 <code>0</code> 全部匹配了，结果 <code>0*</code> 只能匹配空字符串了。<p>必须让 <code>\d+</code> 采用非贪婪匹配（也就是<strong>尽可能少匹配</strong>），才能把后面的 <code>0</code> 匹配出来，加个 <code>?</code><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>string <span class="token operator">=</span> <span class="token string">'102300'</span></pre><tr><td data-num=4><td><pre>pattern <span class="token operator">=</span> <span class="token string">r'^(\d+?)(0*)$'</span></pre><tr><td data-num=5><td><pre>m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string<span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=8><td><pre><span class="token comment"># &LTre.Match object; span=(0, 7), match='1023000'></span></pre><tr><td data-num=9><td><pre><span class="token comment"># ('1023', '000')</span></pre></table></figure><blockquote><p>采用非贪婪匹配，会<strong>匹配最短的满足序列</strong>，并存入列表<p>而<strong>贪婪匹配</strong>则会匹配最长的满足序列</blockquote><blockquote><h3 id=编译><a class=anchor href=#编译>#</a> 编译</h3></blockquote><p>当我们在 Python 中使用正则表达式时，re 模块<strong>内部</strong>会干两件事情：<ol><li>编译正则表达式，如果正则表达式的字符串本身不合法，<strong>会报错</strong>；（<em>输入错误是会报错</em>）<li>用编译后的正则表达式去匹配字符串。</ol><p>如果一个正则表达式要重复使用几千次，出于效率的考虑，我们可以<strong>预编译</strong>该正则表达式<p>接下来重复使用时就不需要编译这个步骤了，直接匹配：<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tbody><tr><td data-num=1><td><pre><span class="token keyword">import</span> re</pre><tr><td data-num=2><td><pre></pre><tr><td data-num=3><td><pre>string <span class="token operator">=</span> <span class="token string">'010-12345'</span></pre><tr><td data-num=4><td><pre>re_telephone <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'^(\d{3})-(\d{3,8}$)'</span><span class="token punctuation">)</span></pre><tr><td data-num=5><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re_telephone<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=6><td><pre><span class="token comment"># ('010', '12345')</span></pre></table></figure><blockquote><p>采用 re 模块中的 <code>re.compile()</code> 方法</blockquote><p>编译后生成<strong> Regular Expression</strong> 对象，由于该对象自己包含了正则表达式，所以调用对应的方法时不用给出正则字符串。<blockquote><p>如果时常遇到正则表达式问题可以去翻官方文档</blockquote><div class=tags><a href=/tags/Python/ rel=tag><i class="ic i-tag"></i>Python</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span><span class=text>更新于</span><time title="修改时间：2024-02-08 15:51:53" datetime=2024-02-08T15:51:53+08:00 itemprop=dateModified>2024-02-08</time></span></div><div class=reward><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*<div id=qr><div><img alt="Liuyanv 微信支付" data-src=/assets/wechatpay.webp loading=lazy><p>微信支付</div><div><img alt="Liuyanv 支付宝" data-src=/assets/alipay.webp loading=lazy><p>支付宝</div></div></div><div id=copyright><ul><li class=author><strong>本文作者：</strong>Liuyanv<i class="ic i-at"><em>@</em></i>欢迎来到Lyanv的小破站<li class=link><strong>本文链接：</strong><a href=https://liuyanv.github.io/2024/02/04/Python%E9%AB%98%E7%BA%A7/ title=Python高级>https://liuyanv.github.io/2024/02/04/Python高级/</a><li class=license><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</ul></div></footer></article></div><div class=post-nav><div class="item left"><a data-background-image=https://i.imgtg.com/2023/03/09/YSIlc.jpg href=/2024/01/24/Lyanv%E7%9A%84blog/ itemprop=url rel=prev title=Lyanv的Blog><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i>杂谈</span><h3>Lyanv的Blog</h3></a></div><div class="item right"></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B><span class=toc-number>1.</span> <span class=toc-text> 面向对象编程</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%B1%BBclass%E5%92%8C%E5%AE%9E%E4%BE%8Binstance><span class=toc-number>1.1.</span> <span class=toc-text> 类 (class) 和实例 (Instance)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%B1%BB%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%8C%96><span class=toc-number>1.1.1.</span> <span class=toc-text> 类的创建和实例化</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7><span class=toc-number>1.2.</span> <span class=toc-text> 实例属性</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95><span class=toc-number>1.3.</span> <span class=toc-text> 类的方法</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6><span class=toc-number>1.4.</span> <span class=toc-text> 访问限制</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E6%80%81><span class=toc-number>1.5.</span> <span class=toc-text> 继承和多态</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BB%A7%E6%89%BF><span class=toc-number>1.5.1.</span> <span class=toc-text> 继承</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E4%BF%A1%E6%81%AF><span class=toc-number>1.6.</span> <span class=toc-text> 获取对象信息</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#isinstance><span class=toc-number>1.6.1.</span> <span class=toc-text> isinstance()</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#dir><span class=toc-number>1.6.1.1.</span> <span class=toc-text> dir()</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%B5%8B%E8%AF%95%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95><span class=toc-number>1.6.2.</span> <span class=toc-text> 测试对象属性和方法</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E5%92%8C%E7%B1%BB%E5%B1%9E%E6%80%A7><span class=toc-number>1.7.</span> <span class=toc-text> 实例属性和类属性</span></a></ol><li class="toc-item toc-level-1"><a class=toc-link href=#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B><span class=toc-number>2.</span> <span class=toc-text> 面向对象高级编程</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%B1%BB%E7%9A%84%E6%9C%AC%E6%BA%90><span class=toc-number>2.1.</span> <span class=toc-text> 类的本源</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%BF%E7%94%A8__slots__><span class=toc-number>2.2.</span> <span class=toc-text> 使用 __slots__</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E9%99%90%E5%88%B6%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%8F%8A%E6%96%B9%E6%B3%95><span class=toc-number>2.2.0.1.</span> <span class=toc-text> 限制对象属性及方法</span></a><li class="toc-item toc-level-4"><a class=toc-link href=#%E4%BD%BF%E7%94%A8__slots__%E9%99%90%E5%88%B6%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7><span class=toc-number>2.2.0.2.</span> <span class=toc-text> 使用 __slots__ 限制实例属性</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%B1%BB%E5%A4%96%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95><span class=toc-number>2.2.1.</span> <span class=toc-text> 类外定义属性和方法</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%BF%E7%94%A8property><span class=toc-number>2.3.</span> <span class=toc-text> 使用 @property</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#property%E5%85%B6%E5%AE%9E%E5%B0%B1%E6%98%AF%E4%B8%AA%E8%AE%BF%E9%97%AE%E5%99%A8getter><span class=toc-number>2.3.0.1.</span> <span class=toc-text> @property 其实就是个访问器（Getter）</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#xxxdeleter><span class=toc-number>2.3.0.1.1.</span> <span class=toc-text> @XXX.deleter</span></a></ol></ol></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF><span class=toc-number>2.4.</span> <span class=toc-text> 多重继承</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9A%E5%88%B6%E7%B1%BBclass><span class=toc-number>2.5.</span> <span class=toc-text> 定制类 (class)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#__str__><span class=toc-number>2.5.1.</span> <span class=toc-text> __str__</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#__iter__><span class=toc-number>2.5.2.</span> <span class=toc-text> __iter__</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#__getitem__><span class=toc-number>2.5.3.</span> <span class=toc-text> __getitem__</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#__getattr__><span class=toc-number>2.5.4.</span> <span class=toc-text> __getattr__</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#__call__><span class=toc-number>2.5.4.1.</span> <span class=toc-text> __call__</span></a></ol></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9E%9A%E4%B8%BE%E7%B1%BBenum-class><span class=toc-number>2.6.</span> <span class=toc-text> 枚举类 (Enum class)</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%85%83%E7%B1%BB><span class=toc-number>2.7.</span> <span class=toc-text> 元类</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#%E9%87%8D%E6%8B%BEtype><span class=toc-number>2.7.0.0.1.</span> <span class=toc-text> 重拾 type()</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#metaclass><span class=toc-number>2.7.1.</span> <span class=toc-text> metaclass</span></a><li class="toc-item toc-level-1"><a class=toc-link href=#%E9%94%99%E8%AF%AF%E8%B0%83%E8%AF%95%E4%B8%8E%E6%B5%8B%E8%AF%95><span class=toc-number>3.</span> <span class=toc-text> 错误调试与测试</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86><span class=toc-number>3.1.</span> <span class=toc-text> 错误处理</span></a><li class="toc-item toc-level-2"><a class=toc-link href=#try><span class=toc-number>3.2.</span> <span class=toc-text> try</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B0%83%E7%94%A8%E6%A0%88><span class=toc-number>3.2.1.</span> <span class=toc-text> 调用栈</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF><span class=toc-number>3.2.2.</span> <span class=toc-text> 记录错误</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF><span class=toc-number>3.2.3.</span> <span class=toc-text> 抛出错误</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%B0%83%E8%AF%95><span class=toc-number>3.3.</span> <span class=toc-text> 调试</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%96%AD%E8%A8%80><span class=toc-number>3.3.1.</span> <span class=toc-text> 断言</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#logging><span class=toc-number>3.3.2.</span> <span class=toc-text> logging</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#pdb><span class=toc-number>3.3.3.</span> <span class=toc-text> pdb</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#pdbset_trace><span class=toc-number>3.3.4.</span> <span class=toc-text> pdb.set_trace()</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#ide><span class=toc-number>3.3.5.</span> <span class=toc-text> IDE</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95><span class=toc-number>3.4.</span> <span class=toc-text> 单元测试</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#setup%E4%B8%8Eteardown><span class=toc-number>3.4.1.</span> <span class=toc-text> setUp 与 tearDown</span></a></ol><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95><span class=toc-number>3.5.</span> <span class=toc-text> 文档测试</span></a></ol><li class="toc-item toc-level-1"><a class=toc-link href=#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F><span class=toc-number>4.</span> <span class=toc-text> 正则表达式</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%9B%E9%98%B6><span class=toc-number>4.0.1.</span> <span class=toc-text> 进阶</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#re%E6%A8%A1%E5%9D%97><span class=toc-number>4.0.2.</span> <span class=toc-text> re 模块</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%87%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2><span class=toc-number>4.0.3.</span> <span class=toc-text> 切分字符串</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%86%E7%BB%84><span class=toc-number>4.0.4.</span> <span class=toc-text> 分组</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B4%AA%E5%A9%AA%E5%8C%B9%E9%85%8D><span class=toc-number>4.0.5.</span> <span class=toc-text> 贪婪匹配</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BC%96%E8%AF%91><span class=toc-number>4.0.6.</span> <span class=toc-text> 编译</span></a></ol></div><div class="related panel pjax" data-title=系列文章><ul><li class=active><a href=/2024/02/04/Python%E9%AB%98%E7%BA%A7/ rel=bookmark title=Python高级>Python高级</a></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img alt=Liuyanv class=image data-src=/assets/avatar.webp itemprop=image loading=lazy><p class=name itemprop=name>Liuyanv<div class=description itemprop=description>神鬼二象性</div></div><nav class=state><div class="item posts"><a href=/archives/><span class=count>2</span><span class=name>文章</span></a></div><div class="item categories"><a href=/categories/><span class=count>2</span><span class=name>分类</span></a></div><div class="item tags"><a href=/tags/><span class=count>2</span><span class=name>标签</span></a></div></nav><div class=social><a class="item github" href=https://github.com/Liuyanv rel=noopener target=_blank title=https://github.com/Liuyanv><i class="ic i-github"></i></a></div><div class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i>首页</a><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-user"></i>关于</a><ul class=submenu><li class=item><a href=/page1/ rel=section><i class="ic i-person"></i>关于本站</a><li class=item><a href=/page1/ rel=section><i class="ic i-coffee"></i>支持博主</a></ul><li class="item dropdown"><a href=/archives/ rel=section><i class="ic i-stars"></i>文章</a><ul class=submenu><li class=item><a href=/categories/ rel=section><i class="ic i-archive"></i>分类</a><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i>标签</a></ul><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-heart"></i>友链</a><ul class=submenu><li class=item><a rel="section noopener" href=https://www.yunliyunwai.cn/ target=_blank><i class="ic i-cloud"></i>云顶书院</a></ul></div></div></div></div><ul id=quick><li class="prev pjax"><li class=up><i class="ic i-arrow-up"></i><li class=down><i class="ic i-arrow-down"></i><li class="next pjax"><a href=/2024/01/24/Lyanv%E7%9A%84blog/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a><li class=percent></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/%E6%9D%82%E8%B0%88/ title=分类于杂谈>杂谈</a></div><span><a href=/2024/01/24/Lyanv%E7%9A%84blog/>Lyanv的Blog</a></span><li class=item><div class=breadcrumb><a href=/categories/Python/ title=分类于Python>Python</a></div><span><a href=/2024/02/04/Python%E9%AB%98%E7%BA%A7/>Python高级</a></span></ul></div></div><div class=status><div class=copyright>© 2010 -<span itemprop=copyrightYear>2024</span><span class=with-love><i class="ic i-sakura rotate"></i></span><span class=author itemprop=copyrightHolder>Liuyanv @ LyanvのBlog</span></div><div class=count><span class=post-meta-item-icon><i class="ic i-chart-area"></i></span><span title=站点总字数>56k 字</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon><i class="ic i-coffee"></i></span><span title=站点阅读时长>51 分钟</span></div><div class=powered-by>基于 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & Theme.<a href=https://github.com/theme-shoka-x/hexo-theme-shokaX/ rel=noopener target=_blank>ShokaX</a></div></div></div></footer></div><script data-config>var LOCAL = {
        path: `2024/02/04/Python高级/`,
        favicon: {
        show: `Liuyanv`,
        hide: `LyanvのBlog`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: {},
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src=https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.prod.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js></script><script src=https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js></script><script src=/js/app.js?v=0.3.13></script>